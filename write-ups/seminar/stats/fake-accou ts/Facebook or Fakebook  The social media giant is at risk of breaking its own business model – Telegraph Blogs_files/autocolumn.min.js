(function(b){b.fn.columnize=function(a){var d={width:400,columns:false,buildOnce:false,overflow:false,doneFunc:function(){},target:false,ignoreImageLoading:true,columnFloat:"left",lastNeverTallest:false,accuracy:false};var a=b.extend(d,a);if(typeof(a.width)=="string"){a.width=parseInt(a.width);if(isNaN(a.width)){a.width=d.width}}return this.each(function(){var t=a.target?b(a.target):b(this);var q=b(this).height();var c=b("<div></div>");var z=0;var u=false;var p=0;c.append(b(this).contents().clone(true));if(!a.ignoreImageLoading&&!a.target){if(!t.data("imageLoaded")){t.data("imageLoaded",true);if(b(this).find("img").length>0){var w=function(f,e){return function(){if(!f.data("firstImageLoaded")){f.data("firstImageLoaded","true");f.empty().append(e.children().clone(true));f.columnize(a)}}}(b(this),c);b(this).find("img").one("load",w);b(this).find("img").one("abort",w);return}}}t.empty();r();if(!a.buildOnce){b(window).resize(function(){if(!a.buildOnce&&b.browser.msie){if(t.data("timeout")){clearTimeout(t.data("timeout"))}t.data("timeout",setTimeout(r,200))}else{if(!a.buildOnce){r()}else{}}})}function v(e,k,i,h){while(i.height()<h&&k[0].childNodes.length){e.append(k[0].childNodes[0])}if(e[0].childNodes.length==0){return}var f=e[0].childNodes;var o=f[f.length-1];e[0].removeChild(o);var j=b(o);if(j[0].nodeType==3){var m=j[0].nodeValue;var n=a.width/18;if(a.accuracy){n=a.accuracy}var g;var l=null;while(i.height()<h&&m.length){if(m.indexOf(" ",n)!="-1"){g=m.substring(0,m.indexOf(" ",n))}else{g=m}l=document.createTextNode(g);e.append(l);if(m.length>n){m=m.substring(m.indexOf(" ",n))}else{m=""}}if(i.height()>=h&&l!=null){e[0].removeChild(l);m=l.nodeValue+m}if(m.length){j[0].nodeValue=m}else{return false}}if(k.children().length){k.prepend(j)}else{k.append(j)}return j[0].nodeType==3}function s(g,e,f,h){if(e.children().length){$cloneMe=e.children(":first");$clone=$cloneMe.clone(true);if($clone.prop("nodeType")==1&&!$clone.hasClass("dontend")){g.append($clone);if($clone.is("img")&&f.height()<h+20){$cloneMe.remove()}else{if(!$cloneMe.hasClass("dontsplit")&&f.height()<h+20){$cloneMe.remove()}else{if($clone.is("img")||$cloneMe.hasClass("dontsplit")){$clone.remove()}else{$clone.empty();if(!v($clone,$cloneMe,f,h)){if($cloneMe.children().length){s($clone,$cloneMe,f,h)}}if($clone.get(0).childNodes.length==0){$clone.remove()}}}}}}}function y(){if(t.data("columnized")&&t.children().length==1){return}t.data("columnized",true);t.data("columnizing",true);t.empty();t.append(b("<div class='first last column' style='width:100%; float: "+a.columnFloat+";'></div>"));$col=t.children().eq(t.children().length-1);$destroyable=c.clone(true);if(a.overflow){targetHeight=a.overflow.height;v($col,$destroyable,$col,targetHeight);if(!$destroyable.contents().find(":first-child").hasClass("dontend")){s($col,$destroyable,$col,targetHeight)}while(x($col.children(":last").length&&$col.children(":last").get(0))){var g=$col.children(":last");g.remove();$destroyable.prepend(g)}var h="";var e=document.createElement("DIV");while($destroyable[0].childNodes.length>0){var j=$destroyable[0].childNodes[0];for(var i=0;i<j.attributes.length;i++){if(j.attributes[i].nodeName.indexOf("jQuery")==0){j.removeAttribute(j.attributes[i].nodeName)}}e.innerHTML="";e.appendChild($destroyable[0].childNodes[0]);h+=e.innerHTML}var f=b(a.overflow.id)[0];f.innerHTML=h}else{$col.append($destroyable)}t.data("columnizing",false);if(a.overflow){a.overflow.doneFunc()}}function x(e){if(e.nodeType!=1){return false}if(b(e).hasClass("dontend")){return true}if(e.childNodes.length==0){return false}return x(e.childNodes[e.childNodes.length-1])}function r(){if(z==t.width()){return}z=t.width();var U=Math.round(t.width()/a.width);if(a.columns){U=a.columns}if(U<=1){return y()}if(t.data("columnizing")){return}t.data("columnized",true);t.data("columnizing",true);t.empty();t.append(b("<div style='width:"+(Math.floor(100/U))+"%; float: "+a.columnFloat+";'></div>"));V=t.children(":last");V.append(c.clone());q=V.height();t.empty();var R=q/U;var P=true;var o=3;var i=false;if(a.overflow){o=1;R=a.overflow.height}else{if(a.height&&a.width){o=1;R=a.height;i=true}}for(var aa=0;aa<o;aa++){t.empty();var Y;try{Y=c.clone(true)}catch(f){Y=c.clone()}Y.css("visibility","hidden");for(var j=0;j<U;j++){var ab=(j==0)?"first column":"column";var ab=(j==U-1)?("last "+ab):ab;t.append(b("<div class='"+ab+"' style='width:"+(Math.floor(100/U))+"%; float: "+a.columnFloat+";'></div>"))}var j=0;while(j<U-(a.overflow?0:1)||i&&Y.contents().length){if(t.children().length<=j){t.append(b("<div class='"+ab+"' style='width:"+(Math.floor(100/U))+"%; float: "+a.columnFloat+";'></div>"))}var V=t.children().eq(j);v(V,Y,V,R);if(!Y.contents().find(":first-child").hasClass("dontend")){s(V,Y,V,R)}else{}while(x(V.children(":last").length&&V.children(":last").get(0))){var Z=V.children(":last");Z.remove();Y.prepend(Z)}j++}if(a.overflow&&!i){var n=false;var O=(document.all)&&(navigator.appVersion.indexOf("MSIE 7.")!=-1);if(n||O){var k="";var X=document.createElement("DIV");while(Y[0].childNodes.length>0){var g=Y[0].childNodes[0];for(var j=0;j<g.attributes.length;j++){if(g.attributes[j].nodeName.indexOf("jQuery")==0){g.removeAttribute(g.attributes[j].nodeName)}}X.innerHTML="";X.appendChild(Y[0].childNodes[0]);k+=X.innerHTML}var T=b(a.overflow.id)[0];T.innerHTML=k}else{b(a.overflow.id).empty().append(Y.contents().clone(true))}}else{if(!i){V=t.children().eq(t.children().length-1);while(Y.contents().length){V.append(Y.contents(":first"))}var W=V.height();var h=W-R;var e=0;var Q=10000000;var m=0;var l=false;t.children().each(function(A){return function(C){var B=A.children().eq(C).height();l=false;e+=B;if(B>m){m=B;l=true}if(B<Q){Q=B}}}(t));var S=e/U;if(a.lastNeverTallest&&l){p+=30;if(p<100){R=R+30;if(aa==o-1){o++}}else{aa=o}}else{if(m-Q>30){R=S+30}else{if(Math.abs(S-R)>20){R=S}else{aa=o}}}}else{t.children().each(function(A){V=t.children().eq(A);V.width(a.width+"px");if(A==0){V.addClass("first")}else{if(A==t.children().length-1){V.addClass("last")}else{V.removeClass("first");V.removeClass("last")}}});t.width(t.children().length*a.width+"px")}}t.append(b("<br style='clear:both;'>"))}t.find(".column").find(":first.removeiffirst").remove();t.find(".column").find(":last.removeiflast").remove();t.data("columnizing",false);if(a.overflow){a.overflow.doneFunc()}a.doneFunc()}})}})(jQuery);