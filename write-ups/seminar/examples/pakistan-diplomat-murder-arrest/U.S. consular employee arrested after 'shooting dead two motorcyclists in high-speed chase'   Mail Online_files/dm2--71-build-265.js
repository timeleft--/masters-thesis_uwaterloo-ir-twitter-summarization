
DM.ExpansionMyStoriesPage=Ext.extend(Ext.util.Observable,{constructor:function(id){this.el=Ext.get(id).on("click",this._clickHandler,this);},_clickHandler:function(e,t){var link=Ext.get(e.getTarget('.columnist-archive-heading',3))||Ext.get(e.getTarget('a.js-more-link',3));console.info("link ",link)
if(link){e.preventDefault();var header=link.hasClass('js-columnist-archive-group')?link:link.parent(".js-my-stories-group")||link.parent(".js-columnist-archive-group");!header.hasClass("collapsed")?this._collapse(header):this._expand(header);}},_collapse:function(el){el.addClass("collapsed");},_expand:function(el){el.removeClass("collapsed");}});var G_IMG_SRV="http://f.dailymail.co.uk";DM.Fn=(function(){var initClass=function(type,items){var cls,initFn,scope,l=items.length;if(typeof DM[type]==='undefined'){type=type.charAt(0).toUpperCase()+type.slice(1);if(typeof DM[type]==='undefined'){return;}}
cls=DM[type];if(typeof cls==='function'){while(l>0){--l;new cls(items[l].id,items[l].params);}}else if(typeof cls==='object'){if(typeof cls.getInstance==='function'){initFn=cls.getInstance().init;scope=cls.getInstance();}else{initFn=cls.init;scope=cls;}
while(l>0){--l;initFn.call(scope,items[l]);}}};return{init:function(){var type;DM.Omniture.init();if(self!=top)AND.FixIFrame();for(type in DM.m){initClass(type,DM.m[type]);}}}})();var swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"\v1",ag=[0,0,0],ab=null;if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;X=false;ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof O.ActiveXObject!=D){try{var ad=new ActiveXObject(W);if(ad){ab=ad.GetVariable("$version");if(ab){X=true;ab=ab.split(" ")[1].split(",");ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}}catch(Z){}}}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac}}(),k=function(){if(!M.w3){return}if((typeof j.readyState!=D&&j.readyState=="complete")||(typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body))){f()}if(!J){if(typeof j.addEventListener!=D){j.addEventListener("DOMContentLoaded",f,false)}if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);f()}});if(O==top){(function(){if(J){return}try{j.documentElement.doScroll("left")}catch(X){setTimeout(arguments.callee,0);return}f()})()}}if(M.wk){(function(){if(J){return}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}f()})()}s(f)}}();function f(){if(J){return}try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));Z.parentNode.removeChild(Z)}catch(aa){return}J=true;var X=U.length;for(var Y=0;Y<X;Y++){U[Y]()}}function K(X){if(J){X()}else{U[U.length]=X}}function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false)}else{if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false)}else{if(typeof O.attachEvent!=D){i(O,"onload",Y)}else{if(typeof O.onload=="function"){var X=O.onload;O.onload=function(){X();Y()}}else{O.onload=Y}}}}}function h(){if(T){V()}else{H()}}function V(){var X=j.getElementsByTagName("body")[0];var aa=C(r);aa.setAttribute("type",q);var Z=X.appendChild(aa);if(Z){var Y=0;(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");if(ab){ab=ab.split(" ")[1].split(",");M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}else{if(Y<10){Y++;setTimeout(arguments.callee,10);return}}X.removeChild(aa);Z=null;H()})()}else{H()}}function H(){var ag=o.length;if(ag>0){for(var af=0;af<ag;af++){var Y=o[af].id;var ab=o[af].callbackFn;var aa={success:false,id:Y};if(M.pv[0]>0){var ae=c(Y);if(ae){if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);if(ab){aa.success=true;aa.ref=z(Y);ab(aa)}}else{if(o[af].expressInstall&&A()){var ai={};ai.data=o[af].expressInstall;ai.width=ae.getAttribute("width")||"0";ai.height=ae.getAttribute("height")||"0";if(ae.getAttribute("class")){ai.styleclass=ae.getAttribute("class")}if(ae.getAttribute("align")){ai.align=ae.getAttribute("align")}var ah={};var X=ae.getElementsByTagName("param");var ac=X.length;for(var ad=0;ad<ac;ad++){if(X[ad].getAttribute("name").toLowerCase()!="movie"){ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value")}}P(ai,ah,Y,ab)}else{p(ae);if(ab){ab(aa)}}}}}else{w(Y,true);if(ab){var Z=z(Y);if(Z&&typeof Z.SetVariable!=D){aa.success=true;aa.ref=Z}ab(aa)}}}}}function z(aa){var X=null;var Y=c(aa);if(Y&&Y.nodeName=="OBJECT"){if(typeof Y.SetVariable!=D){X=Y}else{var Z=Y.getElementsByTagName(r)[0];if(Z){X=Z}}}return X}function A(){return!a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312)}function P(aa,ab,X,Z){a=true;E=Z||null;B={success:false,id:X};var ae=c(X);if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);Q=null}else{l=ae;Q=X}aa.id=R;if(typeof aa.width==D||(!/%$/.test(aa.width)&&parseInt(aa.width,10)<310)){aa.width="310"}if(typeof aa.height==D||(!/%$/.test(aa.height)&&parseInt(aa.height,10)<137)){aa.height="137"}j.title=j.title.slice(0,47)+" - Flash Player Installation";var ad=M.ie&&M.win?"ActiveX":"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac}else{ab.flashvars=ac}if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");X+="SWFObjectNew";Y.setAttribute("id",X);ae.parentNode.insertBefore(Y,ae);ae.style.display="none";(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae)}else{setTimeout(arguments.callee,10)}})()}u(aa,ab,X)}}function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");Y.parentNode.insertBefore(X,Y);X.parentNode.replaceChild(g(Y),X);Y.style.display="none";(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y)}else{setTimeout(arguments.callee,10)}})()}else{Y.parentNode.replaceChild(g(Y),Y)}}function g(ab){var aa=C("div");if(M.win&&M.ie){aa.innerHTML=ab.innerHTML}else{var Y=ab.getElementsByTagName(r)[0];if(Y){var ad=Y.childNodes;if(ad){var X=ad.length;for(var Z=0;Z<X;Z++){if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8)){aa.appendChild(ad[Z].cloneNode(true))}}}}}return aa}function u(ai,ag,Y){var X,aa=c(Y);if(M.wk&&M.wk<312){return X}if(aa){if(typeof ai.id==D){ai.id=Y}if(M.ie&&M.win){var ah="";for(var ae in ai){if(ai[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="data"){ag.movie=ai[ae]}else{if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"'}else{if(ae.toLowerCase()!="classid"){ah+=" "+ae+'="'+ai[ae]+'"'}}}}}var af="";for(var ad in ag){if(ag[ad]!=Object.prototype[ad]){af+='<param name="'+ad+'" value="'+ag[ad]+'" />'}}aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";N[N.length]=ai.id;X=c(ai.id)}else{var Z=C(r);Z.setAttribute("type",q);for(var ac in ai){if(ai[ac]!=Object.prototype[ac]){if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac])}else{if(ac.toLowerCase()!="classid"){Z.setAttribute(ac,ai[ac])}}}}for(var ab in ag){if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie"){e(Z,ab,ag[ab])}}aa.parentNode.replaceChild(Z,aa);X=Z}}return X}function e(Z,X,Y){var aa=C("param");aa.setAttribute("name",X);aa.setAttribute("value",Y);Z.appendChild(aa)}function y(Y){var X=c(Y);if(X&&X.nodeName=="OBJECT"){if(M.ie&&M.win){X.style.display="none";(function(){if(X.readyState==4){b(Y)}else{setTimeout(arguments.callee,10)}})()}else{X.parentNode.removeChild(X)}}}function b(Z){var Y=c(Z);if(Y){for(var X in Y){if(typeof Y[X]=="function"){Y[X]=null}}Y.parentNode.removeChild(Y)}}function c(Z){var X=null;try{X=j.getElementById(Z)}catch(Y){}return X}function C(X){return j.createElement(X)}function i(Z,X,Y){Z.attachEvent(X,Y);I[I.length]=[Z,X,Y]}function F(Z){var Y=M.pv,X=Z.split(".");X[0]=parseInt(X[0],10);X[1]=parseInt(X[1],10)||0;X[2]=parseInt(X[2],10)||0;return(Y[0]>X[0]||(Y[0]==X[0]&&Y[1]>X[1])||(Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]))?true:false}function v(ac,Y,ad,ab){if(M.ie&&M.mac){return}var aa=j.getElementsByTagName("head")[0];if(!aa){return}var X=(ad&&typeof ad=="string")?ad:"screen";if(ab){n=null;G=null}if(!n||G!=X){var Z=C("style");Z.setAttribute("type","text/css");Z.setAttribute("media",X);n=aa.appendChild(Z);if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1]}G=X}if(M.ie&&M.win){if(n&&typeof n.addRule==r){n.addRule(ac,Y)}}else{if(n&&typeof j.createTextNode!=D){n.appendChild(j.createTextNode(ac+" {"+Y+"}"))}}}function w(Z,X){if(!m){return}var Y=X?"visible":"hidden";if(J&&c(Z)){c(Z).style.visibility=Y}else{v("#"+Z,"visibility:"+Y)}}function L(Y){var Z=/[\\\"<>\.;]/;var X=Z.exec(Y)!=null;return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y}var d=function(){if(M.ie&&M.win){window.attachEvent("onunload",function(){var ac=I.length;for(var ab=0;ab<ac;ab++){I[ab][0].detachEvent(I[ab][1],I[ab][2])}var Z=N.length;for(var aa=0;aa<Z;aa++){y(N[aa])}for(var Y in M){M[Y]=null}M=null;for(var X in swfobject){swfobject[X]=null}swfobject=null})}}();return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};Y.id=ab;Y.swfVersion=X;Y.expressInstall=aa;Y.callbackFn=Z;o[o.length]=Y;w(ab,false)}else{if(Z){Z({success:false,id:ab})}}},getObjectById:function(X){if(M.w3){return z(X)}},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);K(function(){ae+="";ag+="";var aj={};if(af&&typeof af===r){for(var al in af){aj[al]=af[al]}}aj.data=ab;aj.width=ae;aj.height=ag;var am={};if(ad&&typeof ad===r){for(var ak in ad){am[ak]=ad[ak]}}if(Z&&typeof Z===r){for(var ai in Z){if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai]}else{am.flashvars=ai+"="+Z[ai]}}}if(F(Y)){var an=u(aj,am,ah);if(aj.id==ah){w(ah,true)}X.success=true;X.ref=an}else{if(aa&&A()){aj.data=aa;P(aj,am,ah,ac);return}else{w(ah,true)}}if(ac){ac(X)}})}else{if(ac){ac(X)}}},switchOffAutoHideShow:function(){m=false},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]}},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X)}else{return undefined}},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A()){P(Z,aa,X,Y)}},removeSWF:function(X){if(M.w3){y(X)}},createCSS:function(aa,Z,Y,X){if(M.w3){v(aa,Z,Y,X)}},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;if(Z){if(/\?/.test(Z)){Z=Z.split("?")[1]}if(aa==null){return L(Z)}var Y=Z.split("&");for(var X=0;X<Y.length;X++){if(Y[X].substring(0,Y[X].indexOf("="))==aa){return L(Y[X].substring((Y[X].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var X=c(R);if(X&&l){X.parentNode.replaceChild(l,X);if(Q){w(Q,true);if(M.ie&&M.win){l.style.display="block"}}if(E){E(B)}}a=false}}}}();AND.FixIFrame=function(){var fn=function(e){var t=e.getTarget('A');if(!t)return;if(t.target==''){top.location.replace(t.href);}}
Ext.getBody().on('click',fn,this);var forms=document.getElementsByTagName("form"),l=forms.length;while(l>0){--l;forms[l].setAttribute("target","_top");}
setTimeout(function(){var params=window.location.search.substring(1).split("&");for(var i=0,len=params.length;i<len;i++){var param=params[i].split("=");if(param[0]=="dmproxy"){var iFrameId="";if(window.location.search.indexOf("betaonly")!=-1){iFrameId="dmbeta";}else if(window.location.search.indexOf("headeronly")!=-1){iFrameId="dmheader";}else if(window.location.search.indexOf("footeronly")!=-1){iFrameId="dmfooter";}
if(iFrameId!=""){var iFrame=document.createElement('iframe');iFrame.style.border='0px';iFrame.style.width='0px';iFrame.style.height='0px';var windowHeight=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);iFrame.src=param[1]+"?command=updateIFrame&id="+iFrameId+"&attribute=height&value="+windowHeight;document.body.appendChild(iFrame);}}}},1000);}
AND.JSONscriptRequestManager=(function(){var head=document.getElementsByTagName("head").item(0),scriptTag=null,cache={},queue=[],processing=false;var request=function(){this.scope=this;}
request.prototype={scriptUrl:"",callback:null,useCache:true,id:null,params:null,callbackParam:'callback'}
var processQueue=function(){if(queue.length>0){processing=true;var strCallback="jsonCallback"+(new Date()).getTime();window[strCallback]=callback;strCallback=queue[0].callbackParam+"="+strCallback;if(queue[0].scriptUrl.indexOf("?")==-1){strCallback="?"+strCallback;}else if(queue[0].scriptUrl[queue[0].scriptUrl.length-1]!="?"){strCallback="&"+strCallback;}
scriptTag=document.createElement("script");scriptTag.setAttribute("type","text/javascript");scriptTag.setAttribute("src",queue[0].scriptUrl+strCallback);head.appendChild(scriptTag);}}
var callback=function(data){if(data){if(queue[0].useCache)cache[queue[0].id]=data;queue[0].callback.call(queue[0].scope,data,queue[0].params);}else{queue[0].callback.call(queue[0].scope,cache[queue[0].id],queue[0].params);}
queue[0]=null;queue.shift();head.removeChild(scriptTag);processing=false;processQueue();}
return{getScript:function(config){if(!config.scriptUrl&&typeof config.scriptUrl!="string"&&!config.callback&&typeof config.callback!="object")return false;var req=AND.extendObject(new request(),config);req.id=req.scriptUrl.replace(/[^a-z]/gi,"");if(req.useCache&&cache[req.id]){callback(null);}else{queue.push(req);if(!processing)processQueue();}}}})();DM.FormValidator=function(id,conf){Ext.apply(this,conf);this.init({id:id});};DM.FormValidator.prototype={form:null,rules:{'mandatory':{'if':{'value1':'value','method':'empty','value2':''},'then':'error("Please provide a value for this field.")'},'email':{'if':{'value1':'value','method':'matches','value2':/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i},'else':'error("Please provide a valid email address.")'}},types:{'text':'blur focus','password':'blur','textarea':'blur focus keyup','radio':'click','checkbox':'click','select-one':'change','form':'submit reset mouseover mouseout'},init:function(form){this.form=Ext.get(form.id);if(!this.form)return;var that=this;this.rules=Ext.apply(this.rules,this.custom_rules||{});this.form.dom.rules=[];var els=Ext.query('.js-validate',this.form.dom);for(var i=0,l=els.length;i<l;i++){var el=els[i];var elE=Ext.get(el);el.rules=[];var keys=el.className.split('|');for(var j=0,m=keys.length-1;j<m;j++){if(this.rules[keys[j]]){var rule=Ext.apply({field:els[i],'if':'','then':'','else':'',onstart:false},this.rules[keys[j]]);el.rules.push(rule);this.form.dom.rules.push(rule);if(rule.onstart){this.runRule(rule);}}}
if(elE.hasClass('js-defaultvalue')&&el.title&&el.title!=''){el.defaultvalue=true;if(el.value==''){el.value=el.title;}}
if(elE.hasClass('js-countdown')){var counter=Ext.get([this.form.id,el['name'],'countdown'].join('-'));if(counter&&parseInt(counter.dom.innerHTML)!=NaN){el.counter=parseInt(counter.dom.innerHTML);}}
if(elE.hasClass('js-expand')&&el.rows){el.expand=true;}
if(elE.hasClass('js-submit')){el.submit=true;}
var evs=this.types[el.type].split(' ');for(var j=0,m=evs.length;j<m;j++){elE.on(evs[j],this.eHandler,that);}}
var evs=this.types['form'].split(' ');for(var i=0,l=evs.length;i<l;i++){that.form.on(evs[i],this.eHandler,that);}},eHandler:function(e,t){var target=Ext.get(e.target);var that=this;switch(e.type){case'mouseover':if(target.hasClass('js-tooltip')){Ext.fly(target.dom.parentNode).addClass('tooltip-on');}
break;case'mouseout':if(target.hasClass('js-tooltip')){Ext.fly(target.dom.parentNode).removeClass('tooltip-on');}
break;case'reset':setTimeout(function(){that.runRules(target.dom,true);},10);break;case'submit':if(!that.runRules(target.dom)){e.stopEvent();}else{if(that.form.dom.submitextras){that.form.dom.submitextras(that.form)}}
break;case'focus':if(target.dom.defaultvalue&&target.dom.value==target.dom.title){target.dom.value='';}
if(target.dom.expand){target.dom.rows=target.dom.rows*2;target.dom.expand=false;}
case'keyup':if(target.dom.counter){var counter=Ext.get([this.form.id,target.dom['name'],'countdown'].join('-'));if(target.dom.counter<target.dom.value.length){target.dom.value=target.dom.value.substring(0,target.dom.counter)};counter.dom.innerHTML=target.dom.counter-target.dom.value.length;}
break;case'change':if(target.dom.submit){this.form.dom.submit();}
else{if(!target.dom.suspendrules){this.runRules(target.dom);}}
break;case'blur':if(target.dom.defaultvalue&&target.dom.value==''){target.dom.value=target.dom.title;}
default:if(!target.dom.suspendrules){this.runRules(target.dom);}}
if(e.type!='focus'&&target.suspendrules){target.suspendrules=null;}},runRules:function(el,onstart){var valid=true;var container=(el.tagName==='FORM')?el:this.field(el);var errs=Ext.query('.errors',container);for(var i=0,l=errs.length;i<l;i++){errs[i].innerHTML='';errs[i].style.display='none';}
var failed=Ext.query('.failed',container);for(var i=0,l=failed.length;i<l;i++){Ext.fly(failed[i]).removeClass('failed');}
var rules=el.rules;for(var i=0,l=rules.length;i<l;i++){if(!onstart||(onstart&&rules[i].onstart)){valid=this.runRule(rules[i])&&valid;}}
return valid;},runRule:function(rule){var el=rule.field;var err=Ext.query('.errors',this.field(el))[0];var result;var value1=this[rule['if'].value1](el);var value2=rule['if'].value2;if(typeof value2==='number'){Number(value1)};var method=rule['if'].method;switch(method){case'matches':result=(new RegExp(value2)).test(value1);break;case'empty':result=(value1=='')||(el.defaultvalue&&value1==el.title);break;default:eval('result =  value1'+method+'value2');break;}
var error=function(param){if(!Ext.fly(el).hasClass('failed')){var msg=document.createElement('span');msg.innerHTML=param;err.appendChild(msg);err.style.display='';Ext.fly(el).addClass('failed');}
return false;};var show=function(param){Ext.fly(param).dom.style.display='';return true;};var hide=function(param){Ext.fly(param).dom.style.display='none';return true;};if(result&&rule['then']!=''){return eval(rule['then']);}
if(!result&&rule['else']!=''){return eval(rule['else']);}
return true;},field:function(param){return Ext.get([this.form.id,param['name'],'field'].join('-')).dom;},value:function(param){if(param.type=='checkbox'||param.type=='radio'){var values=[];var els=this.field(param).getElementsByTagName('input');for(var i=0,l=els.length;i<l;i++){if(els[i].checked){values.push(els[i].value);}}
return values.join(',');}
return param.value;},'length':function(param){return this.value(param).length;}}
DM.Omniture={init:function(obj){if(!this.defaultObj){this.defaultObj=Ext.apply({},s);}
if(!obj)return;var id=obj.id,params=obj.params;if(id){this.initELs(id,params.value);}
else{this.logCL(params);}},log:function(config){s=Ext.apply({},this.defaultObj);Ext.apply(s,config);if(typeof s.t==='function'){void(s.t());}},logCL:function(params){var s=s_gi(s_account);s.linkTrackVars='None';s.linkTrackEvents='None';if(params.props)Ext.apply(s,params.props);s.tl(true,'o',params.link);},logEL:function(obj,value,force){var s=s_gi(s_account);s.linkTrackVars='None';s.linkTrackEvents='None';var lt=(obj.href!=null)?s.lt(obj.href):'';if(lt=='e'){s.linkTrackVars='prop34,eVar32';s.linkTrackEvents='None';s.eVar32=s.prop34=value;}
if(force)s.tl(obj,'e');},connectCallback:function(type,tag,response){var link,propValue=type+' '+tag;logParams={};switch(type){case'plusone_vote':link=response.href;break;case'twitter_click':link=response.target.baseURI;break;case'facebook_like':link=response;break;}
logParams={link:link,props:{linkTrackVars:'prop4,prop34,eVar32',prop4:type,prop34:propValue,eVar32:propValue}};this.logCL(logParams);},initELs:function(id,value){var el=document.getElementById(id);if(!el)return;var els=Ext.query('a.js-tl',el);for(var i=0,l=els.length;i<l;i++){Ext.fly(els[i]).on('click',function(){DM.Omniture.logEL(this,value);},els[i]);}}};DM.Tabs=Ext.extend(Ext.util.Observable,{linkHk:'.js-links',activeHk:'.js-active',tabIdPrefix:"t-",tabsQuery:".dm-tab",panesQuery:".dm-tab-pane",tabOffClass:null,tabOnClass:null,paneOffClass:"dm-tab-pane-hidden",_onLoadCallBack:null,constructor:function(id,config){DM.Tabs.superclass.constructor.call(this);config&&Ext.apply(this,config);this.el=Ext.get(id);this.tabCnt=Ext.get(this.el.query(this.linkHk)[0]);if(!this.tabCnt)return;this.tabCnt.on('click',this._clickHandler,this);this._tabs=this.el.query(this.tabsQuery);this._panes=this.el.query(this.panesQuery);this._onLoadCallBack&&this._onLoadCallBack();this.currentTab=Ext.get(Ext.query(this.activeHk,this.el.dom)[0]);this.addEvents(['b4change','change']);},_clickHandler:function(e){var trg=Ext.get(e.getTarget(this.tabsQuery,3));if(trg){e.preventDefault();if(!trg.hasClass(this.activeHk)){var id=(trg.dom.id).split(this.tabIdPrefix)[1];this._selectTab(id);this.fireEvent('change',this.currentTab);}}},_selectTab:function(id){this.fireEvent('b4change',this.currentTab);this.reset();this.tab(id);},reset:function(){var tab,pane;var l=this._panes.length;while(l>0){--l;tab=Ext.get(this._tabs[l]);pane=Ext.get(this._panes[l]);tab.addClass(this.tabOffClass).removeClass(this.tabOnClass);pane.addClass(this.paneOffClass);}},tab:function(id){this.currentTab=Ext.get(this.tabIdPrefix+id);this.currentTab.removeClass(this.tabOffClass).addClass(this.tabOnClass);Ext.fly(id).removeClass(this.paneOffClass);}});DM.Headlines=Ext.extend(DM.Tabs,{tabOffClass:["ow-igr2-bx","link-ccogr2","js-unactive"],tabOnClass:["link-wocc","js-active"],constructor:function(id){DM.Headlines.superclass.constructor.call(this,id);},_onLoadCallBack:function(){var heighMain=Ext.fly(this._panes[0]).getHeight();var paneMore=Ext.get(this._panes[1])
var amount=(Ext.isIE6||Ext.isIE7)?0:10;if(paneMore.query("li").length>1){amount=0}
paneMore.setHeight(heighMain-amount);}});DM.PictureSwap=Ext.extend(Ext.util.Observable,{constructor:function(id){this.el=Ext.get(id);if(!this.el)return;this.el.on('mouseover',this._mouseOverHandler,this);var image=Ext.get(id+'-img');this._img=image?image.dom:null;this.addEvents(['change']);},_swap:function(src){if(this._img){this._img.src=src;this.fireEvent('change');}},_mouseOverHandler:function(e){var trg=e.getTarget('a',3),imgSrc;if(!trg){return;}
imgSrc=AND.getParams(trg)[0];imgSrc&&this._swap(imgSrc);}})
DM.Showcase=Ext.extend(Ext.util.Observable,{constructor:function(id){this.el=Ext.get(id);this._showables=this.el.select('.mainImages li');this.el.on('click',this._clickHandler,this);this._prodElX=Ext.fly(this.el.query(".products")[0]).getX();this._prodElY=Ext.fly(this.el.query(".products")[0]).getY();this.addEvents(['startAnim','endAnim']);},_resetShowable:function(el){el.setStyle("visibility","hidden");el.select(".js-product-container").setStyle("opacity",0);},_showShowable:function(el,pos){var h,value=el.getStyle("height");if(value==="0px"||value==="auto"){h=el.dom.offsetHeight-6;}else{h=value.substring(0,(value.length-2));}
el.setStyle({"top":(pos.top-this._prodElY-11)+"px","left":pos.left+"px","width":"0px","height":"0px","visibility":"visible"});this.fireEvent('startAnim');var onEndAnim=this.fireEvent.createDelegate(this,['endAnim']);el.animate({width:{to:251},height:{to:h}},.300,function(){el.select(".js-product-container").item(0).animate({opacity:{to:1}},.300,function(){onEndAnim();});})},_clickHandler:function(e){var parent=trg=Ext.get(e.getTarget());(!trg.hasClass("buy-link")&&!trg.hasClass('promo'))&&e.preventDefault();var liContainer=trg.parent("li");var childIndex=AND.getParams(liContainer.dom)[1];var leftPos;if(childIndex%2===0){leftPos=148;}else{leftPos=10;}
if((trg.is("a")&&trg.hasClass("revealProductMain"))||(parent=trg.parent("a.revealProductMain"))){this._showables.each(function(el){this._resetShowable(el);},this);this._showShowable(Ext.get(AND.getHrefParams(parent.dom)),{top:parent.getY()+10,left:leftPos});}else if(trg.is("img.close")){this._resetShowable(trg.parent("li"));}}});DM.MirrorMirror=Ext.extend(Ext.util.Observable,{_blockAction:false,constructor:function(id,params){this.el=Ext.get(id);this._galleryId=params.galleryId;this._showables=this.el.select('.js-mm-overlay');this.el.on('click',this._clickHandler,this,{preventDefault:true});this.addEvents(['startAnim','endAnim']);this.on('endAnim',this._showShowable);},_getTwin:function(el){var id=el.dom.id;var match=id.match(/[0-9]{1,2}$/gi)[0];(match%2)?++match:--match;return Ext.get("MM_overlay_thumb_overlay_"+this._galleryId+"_"+match);},_resetShowable:function(el,fromUserClick){el.setStyle("visibility","hidden");el.select("div").setStyle("opacity",0);fromUserClick&&arguments.callee(this._getTwin(el));},_showShowable:function(el,fromUserClick){var h=el.getHeight()-26;el.setStyle({"width":"0px","height":"0px","visibility":"visible"});this.fireEvent('startAnim');var onEndAnim=fromUserClick?this.fireEvent.createDelegate(this,['endAnim',this._getTwin(el)]):false;var removeBlock=(function(){this._blockAction=false}).createDelegate(this);el.animate({width:{to:180},height:{to:h}},.300,function(){el.select("div").animate({opacity:{to:1,from:0}},.300,function(){(onEndAnim&&onEndAnim())||(removeBlock());});})},_clickHandler:function(e){var parent=trg=Ext.get(e.getTarget());if((trg.is("a")&&trg.hasClass("js-mm-image-link"))||(parent=trg.parent("a.js-mm-image-link"))){if(!this._blockAction){this._blockAction=true;this._showables.each(function(el){this._resetShowable(el);},this);this._showShowable(parent.next(),true);}}else if(trg.is("img.closebutton")){this._resetShowable(trg.parent("div.js-mm-overlay"),true);}}});DM.Poll=Ext.extend(Ext.util.Observable,{_classes:{pollDiv:'js-poll',pollQuestion:'js-poll-question',pollResults:'js-poll-results',pollResultsData:'js-poll-content',voteButton:'js-vote-button',radio:'js-radio',selectedRadio:'selected',closeButton:'js-close',showYesterdays:'js-show-yesterdays',showAll:'js-show-all',pollWide:'poll-wide'},constructor:function(id,conf){this.el=Ext.get(id);if(!this.el)return;this.el.on("click",this._clickHandler,this);this._spanRadios=this.el.select("."+this._classes.radio);this._checkedRadio=null;this._pollId=conf.pollId;this._questionId=conf.questionId;this._channelId=conf.channelId;this._pollResults=this.el.select("."+this._classes.pollResults).item(0);this._pollQuestion=this.el.select("."+this._classes.pollQuestion).item(0);this._pollResultsData=this._pollResults.select("."+this._classes.pollResultsData).item(0);this._showAll=this.el.select("."+this._classes.showAll).item(0);this._showYesterdays=this.el.select("."+this._classes.showYesterdays).item(0);this.addEvents(['onVote']);},_toggleRelatedRadio:function(el,checked){var radio=el.next().dom;if(checked){radio.checked="checked";this._checkedRadio=radio;}else{radio.checked="";}},_resultsTemplate:(function(){return new Ext.Template('<li class="cleared">','<span class="results-text">{answer}</span>','<span class="results-bar" style="width: {barLength}px;"></span>','<span class="results-score">{percentage}%</span>','</li>').compile();})(),_endTemplate:new Ext.Template('</ul><span>{message}</span></div>').compile(),_callBack:function(m,showYesterdayLink){var startTemplate;if(this.el.hasClass('poll-wide')){startTemplate=new Ext.Template('<div class="poll-results-graph box cleared">','<a class="js-close close" href="#">','<span class="close-btn">&nbsp;</span>Close','</a><p>POLL RESULTS</p><ul>').compile();}else{startTemplate=new Ext.Template('<p>{question}</p><ul>').compile();}
if(m){var html=startTemplate.applyTemplate({question:m.poll.pollQuestions[0]["question"]});for(var i=0;i<m.poll.pollQuestions[0].answers.length;i++){html+=this._resultsTemplate.applyTemplate({answer:m.poll.pollQuestions[0].answers[i]["answer"],barLength:m.poll.pollQuestions[0].answers[i]["barLength"],percentage:m.poll.pollQuestions[0].answers[i]["percentage"]});}
var tmp={};if(m.pollAnswered||showYesterdayLink){(m.pollAnswered)?(tmp.message="Oops! You have already voted on this topic"):(tmp.message="");}else{tmp.message="Thank you for voting"}
html+=this._endTemplate.applyTemplate({"message":tmp.message});this._pollResultsData.dom.innerHTML=html;this._pollQuestion.addClass('hidden');this._pollResults.removeClass('hidden');this._switchFootLink(showYesterdayLink);}
this.fireEvent('onVote');},_vote:function(){if(this._checkedRadio){AjaxPoll.vote(this._pollId,this._checkedRadio.value,this._questionId,this._callBack.createDelegate(this,[false],true));}},_close:function(){this._pollQuestion.removeClass('hidden');this._pollResults.addClass('hidden');this._switchFootLink(true);},_switchFootLink:function(showAll){if(!this._showAll){return;}
if(showAll){this._showAll.removeClass('hidden');this._showYesterdays.addClass('hidden');}else{this._showAll.addClass('hidden');this._showYesterdays.removeClass('hidden');}},_toggleTicked:function(spanRadio){this._spanRadios.each(function(el){if(el!==spanRadio){el.removeClass(this._classes.selectedRadio);this._toggleRelatedRadio(el,false);}},this);spanRadio.addClass(this._classes.selectedRadio);this._toggleRelatedRadio(spanRadio,true)},_clickHandler:function(e,t){var trg=Ext.get(e.getTarget());(!trg.hasClass(this._classes.showAll))&&e.preventDefault();if(trg.hasClass(this._classes.radio)){this._toggleTicked(trg);}else if(trg.hasClass(this._classes.voteButton)||trg.parent("button")){if(this._spanRadios.elements.length>0){this._vote();}else{window.location.href="/debate/polls/poll.html?pollId="+this._pollId;}}else if(trg.hasClass(this._classes.closeButton)||trg.parent("."+this._classes.closeButton)){this._close();}else if(trg.hasClass(this._classes.showYesterdays)){AjaxPoll.getYesterdaysPoll(this._channelId,this._pollId,this._callBack.createDelegate(this,[true],true));}}});DM.AnimHandler=function(id){Ext.fly(id).on("click",this._clickHandler,this,{preventDefault:true});this._img=Ext.get("js-image-"+id);this._animationUrl=this._img.dom.getAttribute("rel");}
DM.AnimHandler.prototype={_clickHandler:function(e,t){Ext.fly(t).hasClass("js-links")&&this._anim();},_anim:function(){this._img.dom.src=this._animationUrl;}}
DM.SelectHandler=function(id,param){Ext.apply(this,param);Ext.get(this.selectId).on("change",this._changeHandler,this);this._selectedTab=Ext.get(this._selectedTabId);}
DM.SelectHandler.prototype={_selectedTabId:"js-0",_changeHandler:function(e,t){var id=t.options[t.selectedIndex].value
var tab=Ext.get("js-"+id);this._switchTab(tab);},_switchTab:function(tab){this._selectedTab.setStyle("display","none");tab.setStyle("display","block");this._selectedTab=tab;}}
DM.Digg=Ext.extend(DM.Tabs,{linkHk:'.dm-tabs',tabOffClass:["xogr2","ow-igr2-bx","js-unactive"],tabOnClass:["ow-iw-bx","js-active"],_diggLoaded:{},_diggTemplate:(function(){return new Ext.Template('<li>'+'<a href="{href}" class="bdrgr3 cleared" target="_blank">'+'<img src="{img}" width="30" height="30" alt="{alt}" />'+'<span class="headline">'+'<span class="arrow-small-r"></span>'+'<span>{headline}</span>'+'</span>'+'<span class="digg-count">{count}</span>'+'</a>'+'</li>').compile();})(),constructor:function(id){DM.Headlines.superclass.constructor.call(this,id);this.on('change',this._onChangeCallBack);var relatedEl=(Ext.fly("js-article-text")&&Ext.fly("js-article-text").query("h1")[0])||Ext.get(document).query("a.current")[0];this._commands={"digg-1":"http://digg.com/tools/services?type=javascript&endPoint=/stories/popular&count=6&sort=promote_date-desc&domain=dailymail.co.uk&size=a","digg-2":"http://digg.com/tools/services?type=javascript&endPoint=/stories/upcoming&count=6&sort=digg_count-desc&domain=dailymail.co.uk&size=a","digg-3":"http://digg.com/tools/services?type=javascript&endPoint=/stories/popular&search="+escape(relatedEl.innerHTML.toLowerCase())+"&count=6&sort=promote_date-desc&domain=dailymail.co.uk&size=a"},this._onChangeCallBack("digg-1");},_onChangeCallBack:function(tab){var tabIndex=(typeof tab!=="string")?tab.id.split("t-")[1]:tab;if(!this._diggLoaded[tabIndex]){this._diggLoaded[tabIndex]=true;AND.JSONscriptRequestManager.getScript({scriptUrl:this._commands[tabIndex],callback:this._load.createDelegate(this,[tabIndex],1)});}},_load:function(data,tabId){var story,imgSrc,tmp="";var G_IMG_SRV="http://f.dailymail.co.uk";for(var i=0,len=data.stories.length;i<len;i++){story=data.stories[i];imgSrc=(!story.thumbnail||story.thumbnail.src=="")?G_IMG_SRV+"/i/furniture/modules/digg_widget/m.png":story.thumbnail.src;tmp+=this._diggTemplate.applyTemplate({href:story.href,img:imgSrc,alt:story.title,headline:story.title,count:story.diggs});}
Ext.fly(tabId).dom.innerHTML="<ul>"+tmp+"</ul>";}});DM.ExpansionArticlePage=Ext.extend(Ext.util.Observable,{constructor:function(id){var el=Ext.get(id),first;if(!el){return;}
this._panels=el.select(".js-headers");first=this._panels.item(0);if(!first){return;}
el.on("click",this._clickHandler,this);this._current=null;this._expand(first);},_clickHandler:function(e,t){var link=Ext.get(e.getTarget('a.js-more-link',2));if(link){e.preventDefault();var header=link.parent(".js-headers");if(this._current!==link&&!(this._current===null&&Ext.fly(t).hasClass("js-firstLink"))){this._current=link;this._resetAll();this._expand(header);}else{header.hasClass("collapsed")?this._collapse(header):this._expand(header);}
var header=link.parent("div.js-headers");header.hasClass("collapsed")?this._expand(header):this._collapse(header);}},_expand:function(el){el.addClass("collapsed");},_collapse:function(el){el.removeClass("collapsed");},_resetAll:function(){this._panels.each(function(el){this._collapse(el);},this);}});DM.Carousel=Ext.extend(Ext.util.Observable,{_cssProp:"left",step:138,speed:0.7,ulCls:'.js-itemList',direction:"horizontal",constructor:function(id,conf){this.el=Ext.get(id);if(!this.el)return;conf&&Ext.apply(this,conf);if(this.direction==='vertical'){this._cssProp='top';}
this._slider=Ext.get(this.el.query(this.ulCls)[0]);Ext.fly(this.el.query(".js-move-next")[0]).on("click",this._move,this,{preventDefault:true});Ext.fly(this.el.query(".js-move-prev")[0]).on("click",this._move,this,{preventDefault:true});this._slider.on("click",this._clickHandler,this);this._slider.on("mouseover",this._mouseOverHandler,this);this.addEvents(['changeBegin','changeEnd']);},_mouseOverHandler:function(e,t){},_clickHandler:function(e,t){},_animInstance:null,_isRunning:false,_onEndAnim:function(direction){this._slider.setStyle(this._cssProp,"0");this._isRunning=false;this._shift(direction);},_move:function(e){if(this._isRunning){this._animInstance.stop();}
this._isRunning=true;if(e.getTarget('.js-move-prev')){this.anim("+");}else{this.anim("-");}},anim:function(direction){var par1={};par1[this._cssProp]={to:direction+(this.step)};this._animInstance=this._slider.anim(par1,{duration:this.speed,callback:this._onEndAnim.createDelegate(this,[direction]),scope:this});this.fireEvent("changeBegin",{direction:direction});},_shift:function(direction){if(direction==="+"){var last=this._slider.last();var thirdFromLastClone=last.prev().prev().dom.cloneNode(true);this._slider.insertFirst(thirdFromLastClone);last.remove();this.fireEvent('changeEnd',{cloned:thirdFromLastClone});}else{var first=this._slider.first();var thirdFromFirstClone=Ext.get(first.next().next().dom.cloneNode(true));thirdFromFirstClone.insertAfter(this._slider.last());first.remove();this.fireEvent('changeEnd',{cloned:thirdFromFirstClone.dom});}}});DM.RolloverCarousel=Ext.extend(DM.Carousel,{step:176,_getPanel:function(el){return el.getElementsByTagName("SPAN")[0];},constructor:function(id){var that=this;DM.RolloverCarousel.superclass.constructor.call(this,id);var lis=this.el.query("li");var l=lis.length;var li;while(l>0){--l;li=lis[l];Ext.fly(li).addListener("mouseover",(function(el){return function(e,t){Ext.fly(that._getPanel(el)).animate({top:{to:0}},0.45)}})(li));Ext.fly(li).addListener("mouseout",(function(el){return function(e,t){Ext.fly(that._getPanel(el)).animate({top:{to:110}},0.45)}})(li));}
this.on("changeEnd",function(o){var el=o.cloned;var span=el.getElementsByTagName("SPAN")[0];Ext.fly(el).addListener("mouseover",function(e,t){Ext.fly(span).animate({top:{to:0}},0.45)})
Ext.fly(el).addListener("mouseout",function(e,t){Ext.fly(span).animate({top:{to:110}},0.45)})})}});DM.ImageSwapCarousel=Ext.extend(DM.Carousel,{speed:1.3,step:90,constructor:function(id){DM.ImageSwapCarousel.superclass.constructor.call(this,id);this._bigLink=this.el.query(".js-link")[0];this._bigImg=this.el.query(".js-placeholder")[0];this._caption=this.el.query(".js-caption")[0];this._buyLink=this.el.query(".js-buy-link")[0];this.on("changeBegin",function(o){var el;if(o.direction==="-"){el=this._slider.select("li").item(2).query("a")[0];}else{el=this._slider.first().query("a")[0];}
this._changeBigPic(el);});},_mouseOverHandler:function(e,t){var root=e.getTarget("a",2);root&&this._changeBigPic(root);},_changeBigPic:function(el){if(!this._bigImg){return;}
var hrefBigImg=el.href;var srcBigImg=(el.rel).split("|")[0];this._bigLink.href=hrefBigImg;this._bigImg.src=srcBigImg;var desc=el.getElementsByTagName("IMG")[0].alt;this._caption.innerHTML=desc;var buyLink=Ext.get(el).next('.js-buy-link');if(this._buyLink){this._buyLink.href=(buyLink===null)?'#':buyLink.dom.href;}
Ext.get(this._bigLink).on("click",this._clickHandler,this);}});DM.PopUpCarousel=Ext.extend(DM.Carousel,{step:149,_popUpDisplayed:false,constructor:function(id){DM.PopUpCarousel.superclass.constructor.call(this,id);this._popUpWin=this.el.select(".popup-window").item(0);this._popUp=this.el.select(".popup-container").item(0);this._popUpWin.on("click",this._clickHandlerPopUp,this);this.on("changeBegin",function(o){if(this._popUpDisplayed){var dir=o.direction;if(dir==="+"){this._popUpDisplayed=Ext.fly(this._popUpDisplayed).prev().dom;}else{this._popUpDisplayed=Ext.fly(this._popUpDisplayed).next().dom;}
this._popUp.setStyle("opacity",0);this._popUp.setStyle("height","auto");this._populatePopUp(this._popUpDisplayed.id);this._fadeIn();}})},_resetPopUp:function(){this._popUp.setStyle("opacity",0);this._popUp.setStyle("width",0);this._popUp.setStyle("height","auto");},_clickHandler:function(e,t){e.stopEvent();var trg=e.getTarget("li");if(!trg){return;}
this._popUpDisplayed=trg;this._populatePopUp(trg.id);this._resetPopUp();var h=this._popUp.getHeight();this._popUp.setStyle("height",0);this._popUpWin.setStyle("visibility","visible");this._popUp.anim({width:{to:202},height:{to:h}},{duration:0.4,callback:this._fadeIn,scope:this});},_populatePopUp:function(id){this._popUp.dom.innerHTML=Ext.fly(id+"_container").dom.innerHTML;var img=this._popUp.dom.getElementsByTagName('img')[0];img.src=img.className.split('|')[0];},_fadeIn:function(){this._popUp.animate({opacity:{from:0,to:1}},0.3);},_clickHandlerPopUp:function(e,t){var trg=e.getTarget(".x-closebutton");if(trg){this._popUpWin.setStyle("visibility","hidden");this._popUpDisplayed=false;}}});DM.LightBoxCarousel=Ext.extend(DM.ImageSwapCarousel,{speed:0.8,step:104,constructor:function(id){DM.LightBoxCarousel.superclass.constructor.call(this,id);this._numCols=this.el.query("li.js-column").length;this._inPolePosition=2;this._nextButt=Ext.get(this.el.query(".js-move-next")[0]);this._prevButt=Ext.get(this.el.query(".js-move-prev")[0]);this._nextButt.setStyle("visibility","hidden");this._prevButt.setStyle("visibility","hidden");if(this._numCols===3){this._inPolePosition=1;this._slider.setStyle("left","104px");}
this._handleController();this._universe=this.el.parent(".lightbox-gallery");this._overlay=null;},_handleController:function(){if(this._numCols===3){this._prevButt.setStyle("visibility","hidden");this._nextButt.setStyle("visibility","hidden");return;}
if(this._inPolePosition===1){this._prevButt.setStyle("visibility","hidden");this._nextButt.setStyle("visibility","visible");}else if(this._inPolePosition===(this._numCols-2)){this._nextButt.setStyle("visibility","hidden");this._prevButt.setStyle("visibility","visible");}else{this._prevButt.setStyle("visibility","visible");this._nextButt.setStyle("visibility","visible");}},_increment:function(x){return(x-2)*(-this.step);},_onEndAnim:function(direction){},_getColFirstItem:function(){},anim:function(direction){if((this._inPolePosition>1||direction==="-")&&((this._inPolePosition<(this._numCols-2))||direction==="+")){if(direction==="+"){this._inPolePosition--;}else{this._inPolePosition++;}
this._handleController();var par1={};par1[this._cssProp]={to:this._increment(this._inPolePosition)};this._animInstance=this._slider.anim(par1,{duration:this.speed,callback:this._onEndAnim.createDelegate(this,[direction]),scope:this});}
this.fireEvent("changeBegin",{direction:direction});}});DM.LightBoxCarouselMain=Ext.extend(DM.LightBoxCarousel,{constructor:function(id){DM.LightBoxCarouselMain.superclass.constructor.call(this,id);this._changeBigPic(this.el.query("li.js-column a")[0]);this.on("changeBegin",function(o){var col=this._slider.query("li.js-column")[this._inPolePosition-1];var innerCol=Ext.fly(col).query("li")[0];var link=Ext.fly(innerCol).query("a")[0];this._changeBigPic(link);});this.addEvents(['itemClick']);},_clickHandler:function(e,t){e.stopEvent();var root=e.getTarget("a",2);var buyLink=Ext.get(root).next('.js-buy-link');(!this._docHeight)&&(this._docHeight=Ext.fly(document.getElementsByTagName("BODY")[0]).getHeight()+"px");if(this._overlay===null){this._overlay=Ext.get("overlay");}
this._overlay.setStyle({"display":"block","height":this._docHeight});this.fireEvent("itemClick",{href:root.href,alt:t.alt,pos:this._inPolePosition,buyHref:(buyLink===null)?'#':buyLink.dom.href});}});DM.LightBoxCarouselSub=Ext.extend(DM.LightBoxCarousel,{constructor:function(id){this._target=Ext.get("lightbox-target");var movable=Ext.fly(id).parent("div.js-movable");movable.appendTo(this._target);DM.LightBoxCarouselSub.superclass.constructor.call(this,id);this._gallery=this._universe.select(".wrap_"+id).item(0);this._bigPicHolder=this._gallery.select(".main-image-holder").item(0);this._bigPic=this._gallery.select(".main-overlayimage").item(0);this._picDescContainer=this._gallery.select(".messages").item(0);this._picDesc=this._gallery.select(".mainText").item(0);this._closeButt=this._gallery.select(".x-closebutton").item(0);this._closeButt.on("click",this._closeHandler,this);this._buyLink=this._gallery.query(".buy-link")[0];},showUp:function(href,alt,pos,buyHref){var left=(function(){var wTop=Ext.get("top").getWidth();var wWin=Ext.getBody().getWidth();var left=((wWin-wTop)/2)+wTop;return left;})();this._target.setStyle({"display":"block","top":(AND.getScrollXY()[1]+68)+"px","left":left+"px"});var moreL=this._gallery.query(".more-link")[0];moreL.style.display="none";this._gallery.setStyle("display","block");this._animBigPic(href,alt,buyHref);this._inPolePosition=pos;this._slider.setStyle("left",this._increment(pos)+"px");this._handleController();},_clickHandler:function(e,t){e.stopEvent();var link=Ext.get(e.getTarget('a',2));var buyLink=Ext.get(link).next('.js-buy-link');link&&this._animBigPic(link.dom.href,t.alt,(buyLink===null)?'#':buyLink.dom.href);},_mouseOverHandler:function(e,t){;},_closeHandler:function(e,t){e.stopEvent();if(this._overlay===null){this._overlay=Ext.get("overlay");}
this._overlay.setStyle({"display":"none","height":"0px"});this._gallery.setStyle({"display":"none"});this._resetStage();},_getDimensions:function(str){var res=new RegExp("([0-9]+)x([0-9]+)\.(jpg|png)","gi").exec(str);return[res[1],res[2]];},_resetStage:function(){this._bigPic.setStyle({width:"0px",height:"0px"});this._bigPicHolder.dom.style.opacity="0";this._picDescContainer.setStyle("width","0px");this._picDesc.dom.innerHTML="";},_animBigPic:function(src,desc,buyHref){this._dilate&&this._dilate.stop();var size=this._getDimensions(src);this._fadeIn&&this._fadeIn.stop();this._resetStage();this._bigPic.dom.src=src;if((buyHref==='')||(buyHref.indexOf("#")!==-1)){this._buyLink.href='';this._buyLink.style.display="none";}else{this._buyLink.href=buyHref;this._buyLink.style.display="block";};this._dilate=this._bigPic.anim({"width":{to:size[0]},"height":{to:size[1]}},{duration:0.6,callback:function(){this._picDescContainer.setStyle("width",size[0]+"px");this._picDesc.dom.innerHTML=desc;this._fadeIn=this._bigPicHolder.anim({"opacity":{to:1}},{duration:0.4});},scope:this});}});DM.LightBoxCarouselWrapper=Ext.extend(Ext.util.Observable,{constructor:function(id,config){this.mainC=new DM.LightBoxCarouselMain(id);this.subC=new DM.LightBoxCarouselSub(config.idSubCarousel);this.mainC.on("itemClick",(function(o){this.subC.showUp(o.href,o.alt,o.pos,o.buyHref);}).createDelegate(this));this.subC.on("changeBegin",(function(o){this.mainC.anim(o.direction)}).createDelegate(this));}});DM.Rotator=Ext.extend(Ext.util.Observable,{animDuration:1.2,animEasing:'easeOut',pageSize:3,pageCount:4,activePage:1,activeClass:'link-wocc',constructor:function(elId,config){config=config||{};Ext.apply(this,config);DM.Rotator.superclass.constructor.call(this,config);this.container=Ext.get(elId);this.panels=this.container.child('.rotator-panels');this.pages=this.container.child('.rotator-pages');this._setActivePageClass(1);var item=this.panels.child('li');this.itemWidth=item.getWidth()+/(\d+)/.exec(item.getStyle('margin-right'))[0]*1;this._initEvents();},_setActivePageClass:function(page){this.pages.select('li').each(function(li,idx){if(li.child('a').getAttribute('data-page')==page)
li.addClass(this.activeClass);else
li.removeClass(this.activeClass);},this);},_initEvents:function(){this.pages.on('click',function(evt){evt.preventDefault();var page=evt.target.getAttribute('data-page');if(page=='prev')
this.previous();else if(page=='next')
this.next();else if(page>0)
this.scrollTo(page*1);},this);},scrollTo:function(page){this.activePage=page;this._setActivePageClass(page);var offset=(this.itemWidth*this.pageSize)*(page-1)*(-1);this.panels.stopFx(false);this.panels.anim({left:{to:offset}},{duration:this.animDuration,easing:this.animEasing});},next:function(){var page=(this.activePage>=this.pageCount)?1:(this.activePage+1);this.scrollTo(page);},previous:function(){var page=(this.activePage<=1)?this.pageCount:(this.activePage-1);this.scrollTo(page);}});DM.FootballFeeds=Ext.extend(DM.Tabs,{tabsQuery:".ff-tab",panesQuery:".ff-tab-content",tabOffClass:["wocc","link-wox","js-unactive"],tabOnClass:["link-ccox","selected","js-active"],paneOffClass:"hiddenPane",constructor:function(id){DM.FootballFeeds.superclass.constructor.call(this,id);this._nameMap=[];this._selectedTabId="t-football_1";this._currentPageIndex=0
this._currentCompId="4";this._currentTeamId=null;this._currentMonthId=null;this._hoverTrCl="ff-row-hover";PL=null;SPL=null;this._comboComp=Ext.get('competitionId');this._comboComp.on('change',this._comboCompChangeHandler,this);this._comboTeam=Ext.get('teamId');this._comboTeam.on('change',this._comboTeamChangeHandler,this);this._comboMonth=Ext.get('month');this._comboMonth.on('change',this._comboMonthChangeHandler,this);this._btnGo=Ext.get('ff-submit');this._btnGo.on('click',this._btnGoClickHandler,this);this._pagination=Ext.get('ff-pagination');this._pagination.on("click",this._paginatorClickHandler,this);this._setCompSelectedIndex(0);this._setTeamSelectedIndex(0);this._setMonthSelectedIndex(0);Ext.fly("tabsContainer").on("mouseover",this._tableMOverHandler,this);Ext.fly("tabsContainer").on("mouseout",this._tableMOutHandler,this);this._table_1=Ext.get('football_1_table');this._table_1.on("click",this._teamsTabClickHandler,this);this._table_2=Ext.get('football_2_table');this._table_3=Ext.get('football_3_table');this._loaderEl=Ext.get('ff-loader');this._errorMsgEl=Ext.get('ff-error-msg');this._instructionEl=Ext.get('ff-instruction');this.on('change',this._onChangeTabCallBack,this);},_tamplates:{table:"<table style='width: 290px'>"+"<thead>"+"<tr>"+"<th colspan='2' style='width: 100px'>Teams</th>"+"<th class='align-r numeric'>P</th>"+"<th class='align-r numeric'>GD</th>"+"<th class='align-r numeric'>PTS</th>"+"</tr>"+"</thead>"+"<tbody>",fixtures:"<table style='width: 290px'>"+"<thead>"+"<tr>"+"<th class='align-c' style='width: 115px'>HOME</th>"+"<th class='align-c numeric'>&nbsp;</th>"+"<th class='align-c' style='width: 115px'>AWAY</th>"+"</tr>"+"</thead>"+"<tbody id='football_2_table_body'>",results:"<table style='width: 290px'>"+"<thead>"+"<tr>"+"<th class='align-c' style='width: 110px'>HOME</th>"+"<th class='align-c numeric'>&nbsp;</th>"+"<th class='align-c' style='width: 110px'>AWAY</th>"+"</tr>"+"</thead>"+"<tbody id='football_3_table_body'>"},_showError:function(bool){if(bool){this._errorMsgEl.dom.innerHTML="No Fixtures Found";this._errorMsgEl.setStyle("display","block");}else{this._errorMsgEl.dom.innerHTML="";this._errorMsgEl.setStyle("display","none");}},_generatePaginator:function(o){var pageSize=20;var maxPages=4;var map=function(a,fn){a||(a=[]);fn||(fn=function(x){return x;});var len=a.length,res=new Array(len);for(var i=0;i<len;i++)
res[i]=fn(a[i],i);return res;};var vo={page:Math.round(o.index/pageSize),pages:Math.ceil(o.total/pageSize)};vo.index=o.index;vo.total=o.total;var res=[vo.pages,' pages: page <strong class="ff-pg-current">',vo.page,'</strong> '];var len=((vo.page+maxPages<vo.pages)?maxPages:(vo.pages-vo.page));(len>-1)||(len=0);res.push(map(new Array(len),function(j,i){var n=vo.page+i+1;return n>vo.pages?'':[(i==0?'| ':''),'<span class="ff-pg-page" data-index="',((n-1)*pageSize),'">',n,'</span>'].join('');}).join(' | '));res.unshift('[');res.push(']');if(vo.page>1)
res=['<span class="ff-pg-left"><span class="ff-pg-first" data-index="0">&laquo;</span> '].concat(['<span class="ff-pg-prev" data-index="',((vo.page-2)*pageSize),'">&lt;</span></span> ']).concat(res);if(vo.page<vo.pages)
res=res.concat([' <span class="ff-pg-right"><span class="ff-pg-next" data-index="',(vo.page*pageSize),'">&gt;</span>']).concat(['<span class="ff-pg-last" data-index="',((vo.pages-1)*pageSize),'">&raquo;</span></span>']);return res.join('');},_formatDate:(function(){dateMap={day:{0:'Sunday',1:'Monday',2:'Tuesday',3:'Wednesday',4:'Thursday',5:'Friday',6:'Saturday'},month:{1:'January',2:'February',3:'March',4:'April',5:'May',6:'June',7:'July',8:'August',9:'September',10:'October',11:'November',12:'December'}};return function(d,m,y){var d=new Date(Date.parse([d,' ',dateMap.month[m],', ',y,' 12:00:00 GMT'].join('')));return dateMap.day[d.getUTCDay()]+', '+d.getUTCDate()+' '+dateMap.month[d.getUTCMonth()+1]+' '+d.getUTCFullYear();}})(),_comboCompChangeHandler:function(e){this._currentPageIndex=0;(this._selectedTabId==="t-football_1")&&this._getTables();this._getTeamList();},_comboTeamChangeHandler:function(e){this._currentTeamId=this._getTeamSelected().value;},_paginatorClickHandler:function(e){var trg=e.getTarget("span");if(!trg){return;}
var index=trg.getAttribute("data-index");if(index){this._currentPageIndex=parseInt(index);if(this._selectedTabId==="t-football_2"){this._getFixtures();}else if(this._selectedTabId==="t-football_3"){this._getResults();}}},_teamsTabClickHandler:function(e){e.preventDefault();var trg=e.getTarget("tr");if(trg){var a=Ext.fly(trg).query("a")[0];if(a.className==="generated"){var teamId=parseInt(a.id.substring(3));var urlName=null;if(PL&&PL[teamId]){urlName=PL[teamId];}else if(SPL&&SPL[teamId]){urlName=SPL[teamId];}
urlName&&(window.location.href="/sport/teampages/"+urlName+".html");}else{window.location.href=a.href;}}},_tableMOverHandler:function(e){var trg=e.getTarget("tr");if(trg){Ext.fly(trg).addClass(this._hoverTrCl);}},_tableMOutHandler:function(e){var trg=e.getTarget("tr");if(trg){Ext.fly(trg).removeClass(this._hoverTrCl);}},_btnGoClickHandler:function(e){e.preventDefault();if(this._selectedTabId==="t-football_2"){this._getFixtures();}else if(this._selectedTabId==="t-football_3"){this._getResults();}},_comboMonthChangeHandler:function(e){this._currentMonthId=this._getMonthSelected().value;},_onChangeTabCallBack:function(currentTab){this._selectedTabId=currentTab.dom.id;this._currentPageIndex=0;this._loaderEl.setStyle("display","block");if(currentTab.dom.id!=="t-football_1"){this._comboTeam.setStyle("display","block");this._comboMonth.setStyle("display","block");this._btnGo.setStyle("display","block");if(currentTab.dom.id==="t-football_2"){this._getFixtures();}else if(currentTab.dom.id==="t-football_3"){this._getResults();}}else{this._comboTeam.setStyle("display","none");this._comboMonth.setStyle("display","none");this._btnGo.setStyle("display","none");this._getTables();this._showError(false);}},_setCompSelectedIndex:function(index){this._comboComp.dom.selectedIndex=index;},_getCompSelected:function(){var dom=this._comboComp.dom;var o=dom.options[dom.selectedIndex];return o;},_setTeamSelectedIndex:function(index){this._comboTeam.dom.selectedIndex=index;},_getTeamSelected:function(){var dom=this._comboTeam.dom;var o=dom.options[dom.selectedIndex];return o;},_setMonthSelectedIndex:function(index){this._comboMonth.dom.selectedIndex=index;},_getMonthSelected:function(){var dom=this._comboMonth.dom;var o=dom.options[dom.selectedIndex];return o;},_getTables:function(){if(this._selectedTabId!=="t-football_1"){return;}
this._loaderEl.setStyle("display","block");this._table_1.setStyle("display","none");var o=this._getCompSelected();AjaxFeedsFacade.getTable({competitionId:o.value,compType:o.getAttribute('rel'),feedType:'table'},this._setTables.createDelegate(this));},_setTables:function(r){this._pagination.setStyle("display","none");var HTML=this._createTable(r);this._loaderEl.setStyle("display","none");this._table_1.dom.innerHTML=HTML;this._table_1.setStyle("display","block");if((this._selectedTabId==="t-football_1")&&(this._currentCompId==="4"||this._currentCompId==="17")){this._table_1.dom.className="";this._instructionEl.setStyle("display","block");}else{this._table_1.dom.className="noClick";this._instructionEl.setStyle("display","none");}},_createTable:function(data){var teamList=data.teamList
var namesMap=data.teamNamesMap;var HTML=this._tamplates.table;for(var i=0,len=teamList.length;i<len;i++){var item=teamList[i];if(i%2===0){HTML+="<tr class='clickable-row bow'>";}else{HTML+="<tr class='clickable-row'>";}
HTML+="<td class='ccox numeric bdr-l'>"+(i+1)+"</td>";HTML+="<td class='ff-team link-box linkro-wox'>";HTML+="<a id='ft-"+item.id+"' class='generated' href='#'>"+item.name+"</a>";HTML+="</td>"
HTML+="<td class='align-r numeric'>"+item.totalPlayed+"</td>";HTML+="<td class='align-r numeric'>"+item.totalDifference+"</td>"
HTML+="<td class='align-r numeric bdr-r'>"+item.totalPoints+"</td>";HTML+="</tr>"}
HTML+="</tbody>";HTML+="</table>";return HTML},_getFixtures:function(){this._instructionEl.setStyle("display","none");this._table_2.setStyle("display","none");this._loaderEl.setStyle("display","block");this._pagination.setStyle("display","none");AjaxFeedsFacade.getFixtures({competitionId:this._currentCompId,feedType:'fixtures',month:this._currentMonthId,teamId:this._currentTeamId,startIndex:this._currentPageIndex},this._setFixtures.createDelegate(this));},_setFixtures:function(r){var list=r.fixtureList;var HTML=this._tamplates.fixtures;var date="";var len=list.length
if(len>0){for(var i=0;i<len;i++){var item=list[i];if(date===""||date!==item.gameDate.date){date=item.gameDate.date
HTML+="<tr>";HTML+="<td class='align-c bdr-l bdr-r' colspan='3'>"+this._formatDate(item.gameDate.day,item.gameDate.month,item.gameDate.year)+"</td>";HTML+="</tr>";}
HTML+="<tr class='bow'>";HTML+="<td class='align-r bdr-l'>"+item.firstTeam.name+"</td>";HTML+="<td class='align-c numeric'>v</td>";HTML+="<td class='align-l bdr-r'>"+item.secondTeam.name+"</td>";HTML+="</tr>";}
HTML+="</tbody></table>";this._showError(false);this._loaderEl.setStyle("display","none");this._table_2.dom.innerHTML=HTML;this._table_2.setStyle("display","block");if(r.totalSize>20){var pagHTML=this._generatePaginator({index:(this._currentPageIndex+list.length),total:r.totalSize});this._pagination.dom.innerHTML=pagHTML;this._pagination.setStyle("display","block");}
this._table_2.setStyle("display","block");}else{this._showError(true);this._loaderEl.setStyle("display","none");this._table_2.setStyle("display","none");}},_getResults:function(){this._instructionEl.setStyle("display","none");this._table_3.setStyle("display","none");this._loaderEl.setStyle("display","block");this._pagination.setStyle("display","none");AjaxFeedsFacade.getResults(this._getVO(this._currentPageIndex,"results"),this._setResults.createDelegate(this));},_setResults:function(r){var list=r.fixtureList;var HTML=this._tamplates.results;var date="";var len=list.length
if(len>0){for(var i=0;i<len;i++){var item=list[i];if(date===""||date!==item.gameDate.date){date=item.gameDate.date
HTML+="<tr>";HTML+="<td class='align-c bdr-l bdr-r' colspan='3'>"+this._formatDate(item.gameDate.day,item.gameDate.month,item.gameDate.year)+"</td>";HTML+="</tr>";}
HTML+="<tr class='bow'>";HTML+="<td class='align-r bdr-l'>"+item.firstTeam.name+"</td>";HTML+="<td class='align-c numeric'>"+item.firstTeam.score+"-"+item.secondTeam.score+"</td>";HTML+="<td class='align-l bdr-r'>"+item.secondTeam.name+"</td>";HTML+="</tr>";}
HTML+="</tbody></table>";this._showError(false);this._loaderEl.setStyle("display","none");this._table_3.dom.innerHTML=HTML;this._table_3.setStyle("display","block");if(r.totalSize>20){var pagHTML=this._generatePaginator({index:(this._currentPageIndex+list.length),total:r.totalSize});this._pagination.dom.innerHTML=pagHTML;this._pagination.setStyle("display","block");}
this._table_3.setStyle("display","block");}else{this._showError(true);this._loaderEl.setStyle("display","none");this._table_3.setStyle("display","none");}},_getTeamList:function(){var o=this._getTeamSelected();this._currentTeamId=o.value;AjaxFeedsFacade.getTeamsList(this._getVO(this._currentPageIndex,"table"),this._setTeamList.createDelegate(this));},_setTeamList:function(r){this._nameMap=r;var HTML="";HTML+="<select id='teamId' class='formSelect' name='teamId' style='display: none'>";HTML+="<option value=''>All</option>";for(var i=0,len=r.length;i<len;i++){var item=r[i];HTML+="<option value='"+item.id+"'>"+item.name+"</option>";}
HTML+="</select>";var selContainer=this.el.query(".js-teams")[0];selContainer.innerHTML=HTML;this._comboTeam=Ext.get('teamId');this._comboTeam.on('change',this._comboTeamChangeHandler,this);(this._selectedTabId!=="t-football_1")&&this._comboTeam.setStyle("display","block");this._currentTeamId=null;if(this._currentCompId==="4"&&!PL){PL=this._createNamesMap(r);}else if(this._currentCompId==="17"&&!SPL){SPL=this._createNamesMap(r);}},_createNamesMap:function(arr){var map={};for(var i=0,len=arr.length;i<len;i++){var item=arr[i];map[item.id]=item.seoFriendlyName;}
return map;},_getVO:function(pageIndex,type){var o=this._getCompSelected()
var competition=o.getAttribute('rel');if(this._currentCompId!=o.value){this._currentCompId=o.value;}
return competition<0?false:{competitionId:o.value,compType:competition,feedType:type,month:this._getMonthSelected().value,startIndex:pageIndex||0,teamId:this._getTeamSelected().value};}});DM.Cartoons={init:function(o){this.el=Ext.get(o.id);if(!this.el)return;this.el.on('click',this.onClick,this,{preventDefault:true});},onClick:function(e){var d=this.el.dom;if(!e.getTarget('button[disabled]')){if(e.getTarget('.js-cartoon-next')){d.indexCartoon.value=d.indexNextCartoon.value;d.monthYear.value=d.monthNextYear.value;}
if(e.getTarget('.js-cartoon-previous')){d.indexCartoon.value=d.indexPrevCartoon.value;d.monthYear.value=d.monthPrevYear.value;}
d.submit();}}}
DM.Article={init:function(){var r=AND.getUrlParameter("referrer"),rs;if(r!=""){var AL=Ext.query('ul.article-icon-links','.js-article-text')[0]
if(typeof AL!="undefined"){rs=[{id:"yahoo",url:"http://www.yahoo.co.uk",text:"Return to",img:G_IMG_SRV+"/i/furniture/misc/yahoo_59x12.gif"}];var rTemplate=new Ext.Template('<li class="referrer">'+'<a href="{url}" rel="nofollow">'+'<span>{text}</span>'+'<img src="{img}" alt="{id}" />'+'</a>'+'</li>').compile();var l=rs.length,i=0,htmlStr='';while(i<l){if(r==rs[i].id){htmlStr+=rTemplate.apply(rs[i]);}
i++;}
AL.innerHTML=AL.innerHTML+htmlStr;}}}}
DM.Horoscopes={init:function(){swfobject.embedSWF("/flash/horoscopes.swf","horoscope-flash","636","500","9.0.0",null,{xmlLocation:"/coffeebreak/horoscopes/horoscope.xml"},{allowscriptaccess:"always"},null,function(e){if(e.success){Ext.get("horoscope-text").replaceClass("js-hide","usability");}else{Ext.get("horoscope-text").removeClass("js-hide");}});}};DM.ImageTagging={init:function(o){var el=Ext.get(o.id);if(!el)return;el.on('mouseover',function(e){var ev=e.getTarget('a',3);if(ev)Ext.fly(AND.getParams(ev)[0]+'-tag').addClass('hover');},this);el.on('mouseout',function(e){var ev=e.getTarget('a',3);if(ev)Ext.fly(AND.getParams(ev)[0]+'-tag').removeClass('hover');},this);}}
DM.AzStarSearch={init:function(o){new DM.Tabs(o.id,{tabOnClass:'link-wocc',tabOffClass:['ow-igr2-bx','link-ccogr2'],paneOffClass:'js-hide'});}}
DM.Lightbox=function(){var UI;var constructor=function(){DM.LightboxObj=Ext.extend(Ext.util.Observable,{overlayDuration:0.2,overlayOpacity:0.85,resizeDuration:0.7,constructor:function(){DM.LightboxObj.superclass.constructor.call(this);if(!this.initialized){this.addEvents(['b4open','open','afterOpen','close']);this.initMarkup();this.initialized=true;}},initMarkup:function(){this.shim=Ext.get('lightbox-shim');this.overlay=Ext.get('overlay');this.container=Ext.get('lightbox-container');this.containerElement=Ext.get('lightbox');this.defaultContainer=Ext.get('lightbox-default-container');this.fader=Ext.get('lightbox-fader');this.els=[this.shim,this.overlay,this.defaultContainer,this.container,this.containerElement,this.fader];var l=this.els.length;while(l>0){--l;this.els[l].setVisibilityMode(Ext.Element.DISPLAY);}},open:function(e){this.setViewSize();this.showBg();this.fireEvent('b4open');return this;},showBg:function(){this.overlay.fadeIn({duration:this.overlayDuration,endOpacity:this.overlayOpacity,scope:this});},show:function(pos){var dims=this.position(pos);this.resetEls();this.defaultContainer.shift({height:dims.height,width:dims.width,duration:this.resizeDuration,delay:50});this.fader.shift({height:dims.height,width:dims.width,scope:this,callback:this.contentShow,duration:this.resizeDuration,delay:50});},position:function(pos){this.containerElement.show();var w=this.defaultContainer.getWidth();var h=this.defaultContainer.getHeight();var pageScroll=Ext.fly(document).getScroll();var arrayPageSize=AND.getPageSize();if(pos){this.containerElement.setStyle({top:pos[1]+"px",left:pos[0]+"px"}).show();}else{var lightboxTop=pageScroll.top+((arrayPageSize[3]-35-h)/2);var lightboxLeft=((arrayPageSize[2]-w)/2);this.containerElement.setStyle({top:(lightboxTop<0)?"0px":lightboxTop+"px",left:(lightboxLeft<0)?"0px":lightboxLeft+"px"}).show();}
return{width:w,height:h};},contentShow:function(){this.defaultContainer.setStyle({'visibility':'visible','height':'auto'});this.fireEvent('afterOpen');this.fader.fadeOut({endOpacity:0,duration:this.resizeDuration,callback:function(){this.fader.hide();},scope:this});},resetEls:function(){this.defaultContainer.setStyle({'visibility':'hidden','width':"0px",'height':"0px"});this.fader.setStyle({'display':"block",'width':"0px",'height':"0px",'opacity':'1'});this.container.setStyle('left','0px');},close:function(){this.containerElement.hide();this.overlay.hide();this.shim.hide();this.fireEvent('close');this.defaultContainer.dom.innerHTML='';this.defaultContainer.setStyle({'height':'auto','width':'auto'});},setViewSize:function(){var viewSize=AND.getPageSize(),w=viewSize[0],h=Math.max(viewSize[1],viewSize[3]);this.overlay.setStyle({left:0,top:0,width:w+'px',height:h+'px'});this.shim.setStyle({left:0,top:0,width:w+'px',height:h+'px'}).show();}});}
return{getInstance:function(){if(!UI){constructor();UI=new DM.LightboxObj();}
return UI;}}}();DM.ImageEnlarge={init:function(o){var el=Ext.get(o.id);if(!el)return;el.on('click',function(e){var evEl=e.getTarget('.lightboxPopupLink',3);if(!evEl)return;var that=DM.Lightbox.getInstance();var lnk,pic,cap;var eHandler=function(e){var el;el=e.getTarget('.js-close',3);if(el){this.close();e.preventDefault();return;}}
that.on('b4open',function(){this.defaultContainer.dom.innerHTML='<a href="#" class="js-close bow img-enlarge" >'+'<span class="caption">&nbsp;</span>'+'<img class="close" src="http://i.dailymail.co.uk/i/furniture/misc/close.gif" alt="" />'+'</a>';pic=Ext.get(new Image());lnk=this.defaultContainer.child('a');lnk.insertFirst(pic);pic.on('load',function(){this.fireEvent('open');},this,{single:true});pic.dom.src=evEl.href;},that,{preventDefault:true,single:true});that.on('open',function(){DM.Omniture.log({prop4:'image-enlarge'});DM.ComScore.logPE({mo_vs_ct:'ic',mo_ev_ty:'page',mo_ev_ac:'image',mo_ev_mt:'enlarge'});cap=this.defaultContainer.child('span.caption');cap.dom.innerHTML=evEl.getAttribute('rel').split('!')[0];var w=Number(pic.dom.naturalWidth||pic.dom.width);this.defaultContainer.setStyle('width',w+'px');this.show();this.overlay.on('click',this.close,this,{stopEvent:true,single:true});this.defaultContainer.on('click',eHandler,this,{stopEvent:true,single:true});},that,{preventDefault:true,single:true});that.on('afterOpen',function(){},that,{preventDefault:true,single:true});that.on('close',function(){},that,{preventDefault:true,single:true});that.open(e);},this);}}
DM.Login={init:function(o){var el=Ext.get(o.id);if(!el){return;}
el.on('click',this.open,this,{preventDefault:true,delegate:'.js-login',params:o.params});},open:function(e,t,opt){var evEl,that;if(self!=top)return;that=DM.Lightbox.getInstance();var eHandler=function(e){var el=e.getTarget('.js-close',3);if(el&&e.type=='click'){this.close();e.preventDefault();return;}},load_callback=function(o){var s=o.responseText;if(!s){return false;}
function _onCssError(){if(t.href){window.location=t.href;}}
that.defaultContainer.dom.innerHTML=s.substring(s.indexOf('<!-- content[start] -->')+('<!-- content[start] -->').length,s.indexOf('<!-- content[end] -->'));that.fireEvent('open');},err_callback=function(o){that.overlay.hide();document.location=evEl.href;};that.on('b4open',function(){Ext.Ajax.request({url:opt.params.url,disableCaching:false,success:load_callback,failure:err_callback});},that,{preventDefault:true,single:true});that.on('open',function(){DM.Omniture.log({prop4:"login"});DM.ComScore.logPE({mo_vs_ct:'lc',mo_ev_ty:'page',mo_ev_ac:'login',mo_ev_mt:'lightbox'});this.show();},that,{preventDefault:true,single:true});that.on('afterOpen',function(){this.defaultContainer.on('click',eHandler,this);if(!Ext.isIE){this.defaultContainer.on('change',eHandler,this);}},that,{preventDefault:true,single:true});that.on('close',function(){this.defaultContainer.un('click',eHandler,this);if(!Ext.isIE){this.defaultContainer.un('change',eHandler,this);}},that,{preventDefault:true,single:true});that.open(e);}};DM.Newsletters={init:function(o){var el=Ext.get(o.id),uId=DM.getCookie('authid');if(!el||!uId)return;el.on('click',function(e){var evEl=e.getTarget('.js-nl',3);if(!evEl)return;var that=DM.Lightbox.getInstance();var form=Ext.fly(evEl).parent('form');var eHandler=function(e){var el;el=e.getTarget('.js-close',3);if(el&&e.type=='click'){this.close();e.preventDefault();return;}
el=e.getTarget('button',3);if((Ext.isIE&&e.type=='click'&&el)||(!Ext.isIE&&e.type=='submit')){var arr=new Array;this.defaultContainer.select('input[type=checkbox]').each(function(o){arr.push({'newsletterId':o.dom.value,'subscribed':o.dom.checked})});AjaxNewsletter.subscribeToNewsLetters(uId,arr,subscribe_callback);this.defaultContainer.child('button').dom.disabled=true;e.preventDefault();return;}}
var listTemplate=new Ext.Template('<h2 class="plain ccow">{title}</h2>'+'<p>{text}</p>'+'<table class="bot10"><col width="65"/><col /><col width="230"/>'+'{items}'+'</table>').compile();var itemTemplate=new Ext.Template('<tr>'+'<td><img src="http://i.dailymail.co.uk/i/furniture/reg/{img}" alt="" width="45" height="45"/></td>'+'<th>{name}</th>'+'<td>'+'{opts}'+'</td>'+'</tr>').compile();var optTemplate=new Ext.Template('<label class="cleared" for="nl{id}">'+'<input class="checkbox-input" name="nl" value="{id}" id="nl{id}" type="checkbox" {checked} />'+'{label}'+'</label>').compile();var parse=function(o,title,text){var items='',opts;for(var i=0,l=o.length;i<l;i++){opts='';for(var j=0,m=o[i].subscriptions.length;j<m;j++){opts+=optTemplate.apply({'id':o[i].subscriptions[j].newsletterId,'label':(o[i].subscriptions[j].position1Or2==1)?'I want this daily newsletter.':'I want this breaking newsflash.','checked':(o[i].subscriptions[j].subscribed)?'checked="checked"':''});}
items+=itemTemplate.apply({'name':o[i].displayGroupName,'img':o[i].groupImageUrl,'opts':opts});}
return(items=='')?'':listTemplate.apply({'title':title,'text':text,'items':items});}
var load_callback=function(o){if(o.hasError){form.dom.submit();return;}
that.defaultContainer.dom.innerHTML='<div class="item home reg reg-nl"><form action="#" method="post">'+
parse(o.subscribedNewsletters,'Yours newsletters and newsflashers','You have subscribed for the following newsletters and newsflashers')+
parse(o.notSubscribedNewsletters,'Would you like to subscribe to '+((o.subscribedNewsletters.length)>0?'more':'the following')+' newsletters and breaking newsflashes?','Keep up to date with the latest news and info from MailOnline. Just tick the newsletters and newsflashes you would like to subscribe to.')+'<button class="wocc" type="submit"><span class="arrow-small-r">&nbsp;</span>Submit</button>'+'<a href="#" class="js-close close"><img alt="" src="http://i.dailymail.co.uk/i/furniture/misc/close.gif" /></a>'+'</form></div>';that.fireEvent('open');}
var subscribe_callback=function(o){if(o.hasError){form.dom.submit();return;}
that.defaultContainer.dom.innerHTML='<div class="item home reg reg-nl"><h2 class="plain ccow">Thank you!</h2>'+'<p>You have sucessfully subscribed to the newsletters. Click <a href="#" class="js-close">here</a> to continue.</p>'+'<a href="#" class="js-close close"><img alt="" src="http://i.dailymail.co.uk/i/furniture/misc/close.gif" /></a>'+'</div>';that.position();}
that.on('b4open',function(){AjaxNewsletter.getNewsletters(uId,load_callback);},that,{preventDefault:true,single:true});that.on('open',function(){DM.Omniture.log({prop4:"newsletters"});DM.ComScore.logPE({mo_vs_ct:'nc',mo_ev_ty:'page',mo_ev_ac:'newsletter',mo_ev_mt:'lightbox'});this.show();},that,{preventDefault:true,single:true});that.on('afterOpen',function(){this.defaultContainer.on('click',eHandler,this);if(!Ext.isIE){this.defaultContainer.on('submit',eHandler,this);}},that,{preventDefault:true,single:true});that.on('close',function(){this.defaultContainer.un('click',eHandler,this);if(!Ext.isIE){this.defaultContainer.un('submit',eHandler,this);}},that,{preventDefault:true,single:true});that.open(e);},this,{preventDefault:true});}}
DM.ShareLinks={init:function(o){var el=Ext.get(o.id);if(!el){return;}
el.on('click',this.clickHandler,this,{stopEvent:true,delegate:'a.js-sl',params:o.params});},tpl:null,close:function(e){if(e.getTarget('#share-overlay')){return;}
Ext.getBody().un('click',DM.ShareLinks.close,this);Ext.EventManager.removeListener(window,'resize',DM.ShareLinks.close,this);this.dom.innerHTML='';this.setStyle({display:'none',width:0,height:0});},clickHandler:function(e,t,o){var el=Ext.get(t),params=o.params,elPos=el.getOffsetsTo(Ext.getBody()),artEl,artLinkEl,url,articleId,title,shortUrl,twitterStatus,overlayEl;if(params&&params.title){url=params.url;articleId=params.id;title=params.title;twitterStatus=params.eTwitterStatus;}else{artEl=e.getTarget('.article',7,true)||e.getTarget('.js-article',7,true);if(artEl){artLinkEl=artEl.child('h2 a')||artEl.child('.title');}
if(!artEl||!artLinkEl){return;}
url=location.protocol+'//'+location.host+artLinkEl.getAttribute('href');articleId=/article-(\d+)/.exec(url)[1];title=artLinkEl.dom.childNodes[0].nodeValue;shortUrl=AND.getParams(el.dom)[0]||url;twitterStatus=(title.length>103)?title.substr(0,100)+'...':title;twitterStatus=encodeURIComponent(twitterStatus+' '+shortUrl+' via @MailOnline');}
overlayEl=Ext.get('share-overlay');if(overlayEl){overlayEl.removeClass('open');}else{overlayEl=Ext.getBody().insertHtml('beforeEnd','<div id="share-overlay"></div>',true);}
overlayEl.setStyle({display:'block',width:0,height:0,left:elPos[0]-15+'px',top:elPos[1]+20+'px'});if(!this.tpl){this.tpl=new Ext.Template('<div class="connector">&nbsp;</div>'+'<div class="cleared social-links">'+'<ul class="bigLinks cleared">'+'<li class="facebook"><a target="_new" title="Share this story on Facebook" href="http://www.facebook.com/sharer.php?u={eUrl}" class="js-tl">'+'<span>Facebook</span></a></li>'+'<li class="twitter"><a target="_new" title="Share this story on Twitter" href="http://twitter.com/?status={eTwitterStatus}" class="js-tl">'+'<span>Twitter</span></a></li>'+'<li class="googleplus"><a target="_new" title="Share this story on Google +" href="https://plus.google.com/" class="js-tl">'+'<span>Google+</span></a></li>'+'<li class="messenger"><a target="_new" title="Share this story on Messenger" href="http://profile.live.com/" class="js-tl">'+'<span>Messenger</span></a></li>'+'<li class="linkedin"><a target="_new" title="Share this story on LinkedIn" href="http://www.linkedin.com/shareArticle?mini=true&url={eUrl}&title={eTitle}" class="js-tl">'+'<span>LinkedIn</span></a></li>'+'<li class="digg"><a target="_new" title="Share this story on Digg" href="http://digg.com/submit?phase=2&url={eUrl}&title={eTitle}" class="js-tl">'+'<span>Digg it</span></a></li>'+'<li class="newsvine"><a target="_new" title="Share this story on Newsvine" href="http://www.newsvine.com/_tools/seed&save?u={eUrl}&h={eTitle}" class="js-tl">'+'<span>Newsvine</span></a></li>'+'<li class="fark"><a target="_new" title="Share this story on Fark" href="http://cgi.fark.com/cgi/fark/farkit.pl?u={eUrl}&h={eTitle}" class="js-tl">'+'<span>Fark</span></a></li>'+'<li class="nowpublic"><a target="_new" title="Share this story on Nowpublic" href="http://view.nowpublic.com/?src={eUrl}" class="js-tl">'+'<span>Nowpublic</span></a></li>'+'<li class="reddit"><a target="_new" title="Share this story on Reddit" href="http://reddit.com/submit?url={eUrl}&title={eTitle}" class="js-tl">'+'<span>Reddit</span></a></li>'+'</ul>'+'<div class="bigLinks-3 ow-igr2-bx xogr2">'+'<ul>'+'<li class="print"><a href="{printUrl}" title="Print this article" onclick="DM.popup(\'{printUrl}\', 600, 600); return false;">'+'<span>Print article</span></a></li>'+'<li class="email"><a target="_new" title="Email to a friend" href="{emailUrl}">'+'<span>Email article</span></a></li>'+'</ul>'+'<span class="tl"></span><span class="tr"></span><span class="bl"></span><span class="br"></span>'+'</div>'+'</div>').compile();}
overlayEl.dom.innerHTML=this.tpl.apply({eTitle:encodeURIComponent(title),eUrl:encodeURIComponent(url),emailUrl:/.*\/article-\d+/.exec(url)[0]+'/emailArticle.html',printUrl:url+'?printingPage=true',eTwitterStatus:twitterStatus});if(!overlayEl.dom.getAttribute('data-ready')){overlayEl.on('click',function(e,t){DM.Omniture.logEL(t,'share - '+articleId,true);e.stopEvent();DM.ComScore.logSC(t,{mo_vs_ct:'sc',mo_ev_ty:'share',mo_ev_ac:(t.title)?t.title.toLowerCase().substr(('share this story on ').length):'',mo_ev_pl:'lightbox',mo_ev_as:t.href.toLowerCase().replace(DM.ComScore.cleanRegex,'-')});},overlayEl,{delegate:'a.js-tl'});overlayEl.dom.setAttribute('data-ready','true');}
overlayEl.scale(329,151,{scope:overlayEl,duration:0.7,callback:function(){var el=this.child('.social-links');this.addClass('open');if(!el){return;}
el.fadeIn({duration:0.7});}});Ext.getBody().on('click',this.close,overlayEl);Ext.EventManager.addListener(window,'resize',this.close,overlayEl,{single:true});}};DM.Debate=function(){var UI;function constructor(){var setCursorAtEnd=function(textArea){if(textArea.createTextRange){var r=(textArea.createTextRange());r.moveStart('character',(textArea.value.length));r.collapse();r.select();}
textArea.scrollTop=textArea.scrollHeight;}
var getMessageText=(function(){var textStore='';return function(node){if(node.nodeType==3){textStore+=node.data;}else{var children=node.childNodes;for(var i=0,numChildren=children.length;i<numChildren;i++){if(node.className!="jive-quote"){getMessageText(children[i]);}}}
return textStore;}})()
var copyPasteText=function(el,msgEls){var container=Ext.get(el.id.substr(1)).dom.parentNode.parentNode,userName,quote,message;if(container){userName=Ext.query('span.js-user-name',container)[0].innerHTML;message=getMessageText(Ext.query('div.js-message-body',container)[0]);quote="{quote:title="+userName+" wrote...}"+message+"{quote}";var l=msgEls.length,target;while(l>0){--l;target=msgEls[l];target.value=removeHTMLTags(quote)+"\n";}}}
var removeHTMLTags=function(srcData){if(srcData){var strInputCode=srcData.replace(/&(lt|gt);/g,function(strMatch,p1){return(p1=="lt")?"<":">";});return strInputCode.replace(/<\/?[^>]+(>|$)/g,"");}}
return{init:function(){var msgSub=Ext.query("input.js-message-subject","content");if(msgSub[0]){msgSub[0].focus();}
var msgTextAreas=Ext.query("textarea.js-message-textarea","content");Ext.get("content").on('click',function(e){var a=e.getTarget('a');if(a){if(Ext.fly(a).hasClass('js-reply')){e.preventDefault();var l=msgTextAreas.length;while(l>0){--l;msgTextAreas[l].value='';}
msgTextAreas[0].suspendrules=true;msgTextAreas[0].focus();}else if(Ext.fly(a).hasClass('js-quotereply')){e.preventDefault();copyPasteText(a,msgTextAreas);msgTextAreas[0].suspendrules=true;msgTextAreas[0].focus();setCursorAtEnd(msgTextAreas[0]);}}},this);}};}
return{getInstance:function(){if(!UI){UI=constructor();}
return UI;}}}();DM.DebateAvatar=function(){var UI;function constructor(){var el;var avatarClickHandler=function(e){var tEl=Ext.get(e.getTarget());if(!tEl.hasClass('selected')){var els=Ext.fly(el).query("img.selected");var l=els.length;while(l>0){--l;Ext.fly(els[l]).removeClass("selected");}
tEl.addClass("selected");tEl.next().dom.checked=true;}}
var avatarOver=function(e){Ext.fly(e.getTarget()).replaceClass("bdrw","bdrcc");}
var avatarOut=function(e){Ext.fly(e.getTarget()).replaceClass("bdrcc","bdrw");}
return{init:function(o){el=Ext.get(o.id);el.addClass("enabled-js");var els=Ext.query('img',el.dom),l=els.length,img;while(l>0){--l;img=Ext.fly(els[l]);img.on("click",avatarClickHandler,this);if(Ext.isIE6){img.on("mouseover",avatarOver,this);img.on("mouseout",avatarOut,this);}}}};}
return{getInstance:function(){if(!UI){UI=constructor();}
return UI;}}}();DM.RSS={init:function(o){var t=new DM.Tabs(o.id,{tabOnClass:['bdrcc','link-wocc','xocc',"js-active"],tabOffClass:['bdrgr4','ow-igr2-bx','link-bogr2','xogr4',"js-unactive"],paneOffClass:'js-hide'});t.on('b4change',function(el){el.select('>span').replaceClass('xocc','xogr4');});t.on('change',function(el){t.tabCnt.dom.className=t.tabCnt.dom.className.replace(t.tabCnt.dom.className.split(' ')[0],el.dom.className.split('|')[0]);el.select('>span').replaceClass('xogr4','xocc');});}}
DM.WeatherObj=function(id){this.el=Ext.get(id);this.init();}
DM.WeatherObj.prototype={init:function(){this.form=Ext.get(this.el.dom.getElementsByTagName('form')[0]);if(!this.form)return;this.el.select('.js-submit').on('click',this.eHandler,this);},eHandler:function(){this.form.dom.submit();}}
DM.Twitter=function(id){this.el=Ext.get(id);this._init();}
DM.Twitter.prototype={tweetCount:5,template:new Ext.Template('<li class="bdrgr2 {bottomClass} box">'+'<span class="arrow-small-r"></span>'+'<span class="tweet">{tweet}</span>'+'<span class="when gr4ox">{when}</span>'+'</li>').compile(),relative_time:function(time_value){var values=time_value.split(" ");time_value=values[1]+" "+values[2]+", "+values[5]+" "+values[3];var parsed_date=Date.parse(time_value);var relative_to=(arguments.length>1)?arguments[1]:new Date();var delta=parseInt((relative_to.getTime()-parsed_date)/1000);delta=delta+(relative_to.getTimezoneOffset()*60);if(delta<60){return"less than a minute ago";}else if(delta<120){return"about a minute ago";}else if(delta<(60*60)){return(parseInt(delta/60)).toString()+" minutes ago";}else if(delta<(120*60)){return"about an hour ago";}else if(delta<(24*60*60)){return"about "+(parseInt(delta/3600)).toString()+" hours ago";}else if(delta<(48*60*60)){return"1 day ago";}else{return(parseInt(delta/86400)).toString()+" days ago";}},cleanText:function(t){return t.replace(/((https?|s?ftp|ssh)\:\/\/[^"\s\<\>]*[^.,;'">\:\s\<\>\)\]\!])/g,function(url){return"<a href=\""+url+"\">"+url+"</a>";}).replace(/\B@([_a-z0-9]+)/ig,function(reply){return reply.charAt(0)+"<a href=\"http://twitter.com/"+reply.substring(1)+"\">"+reply.substring(1)+"</a>";});},_init:function(){AND.JSONscriptRequestManager.getScript({scope:this,useCache:false,scriptUrl:"http://twitter.com/statuses/user_timeline/"+this.el.dom.className.match(/twitter\-([a-z_\-A-Z0-9]+)/)[1]+".json?count="+this.tweetCount,callback:this.callback});},callback:function(data){var tmp="";for(var i=0,len=data.length;i<len;i++){if(i==0){Ext.query("div.twitter-footer",this.el.dom)[0].getElementsByTagName("span")[0].innerHTML="Follow "+data[i].user.name.split(" ")[0]+" on Twitter";this.el.dom.getElementsByTagName("h3")[0].innerHTML=data[i].user.name+" on Twitter";if(data[i].user.profile_image_url.indexOf("default")==-1){this.el.dom.getElementsByTagName("img")[0].src=data[i].user.profile_image_url.replace("normal","bigger");}}
tmp+=this.template.apply({tweet:this.cleanText(data[i].text),when:this.relative_time(data[i].created_at),bottomClass:(i==len-1)?"":"no-bot"});}
this.el.dom.getElementsByTagName("ul")[0].innerHTML=tmp;}}
DM.TwitterCombined=function(id,params){Ext.apply(this,params);DM.TwitterCombined.superclass.constructor.call(this,id);}
Ext.extend(DM.TwitterCombined,DM.Twitter,{feedArr:[],dataArr:[],index:0,display:5,url:'http://twitter.com/',template:new Ext.Template('<li class="bdrgr2 {bottomClass} box cleared">'+'<img src="{image}" alt="{name}" class="float-r" />','<a class="title" href="{url}">{name}</a>','<span class="arrow-small-r"></span>'+'<span class="tweet">{tweet}</span>'+'<span class="when gr4ox">{when}</span>'+'</li>').compile(),_init:function(){this.feedArr=this.feeds.split(',');var l=this.feedArr.length;while(l>0){--l;AND.JSONscriptRequestManager.getScript({scope:this,useCache:false,scriptUrl:this.url+"/statuses/user_timeline/"+this.feedArr[l]+".json?count="+this.tweetCount,callback:this.callback});}},writeContent:function(){var d=this.dataArr,l=this.display,s='';d.sort(function(a,b){var date1=Date.parse(a.created_at),date2=Date.parse(b.created_at);return date1-date2;});while(l>0){--l;s+=this.template.apply({name:d[l].user.name,image:d[l].user.profile_image_url,url:this.url+d[l].screen_name,tweet:this.cleanText(d[l].text),when:this.relative_time(d[l].created_at),bottomClass:(l==0)?"no-bot":""});}
this.el.child('ul').dom.innerHTML=s;},callback:function(data){var l=data.length,i=0;while(l>i){this.dataArr.push(data[i]);++i;}
++this.index;if(this.index==this.feedArr.length){this.writeContent();}}});DM.Tools={init:function(o){var t=new DM.Tabs(o.id,{tabOnClass:['link-wox','xocc',"js-active"],tabOffClass:['ow-igr2-bx','link-ccox','xogr2',"js-unactive"],paneOffClass:'dm-tab-pane-hidden'});t.on('b4change',function(el){if(!t.getData){var sel=Ext.query('select.js-makers',t.el.dom)[0];if(sel){AND.JSONscriptRequestManager.getScript({scriptUrl:"http://api.carsource.co.uk/json-manufacturers-list.php",callback:function(data){var l=data.manufacturer.length,i=0;while(l>i){var el=document.createElement("option");el.text=el.value=data.manufacturer[i].value;sel.options.add(el);++i;}}});}
t.getData=true;}});t.on('change',function(el){t.el.dom.className=t.el.dom.className.replace(t.el.dom.className.split(' ')[0],el.dom.className.split('|')[0]);});}}
DM.TravelSearch=function(){var UI;var constructor=function(){var el,depDay,depMon,depYear,cal;var init=function(o){Ext.fly("js-submit-button").on("click",validateForm,this);el=Ext.get("js-calendar-container");if(el){depDay=Ext.get("depdate-day");depMon=Ext.get("depdate-month");depYear=Ext.get("depdate-year");var dateRange=new Date();dateRange.setTime(dateRange.getTime()+(1000*60*60*24*3));cal=new Ext.ux.DatePicker('js-calendar-container',{handler:mySelectHandler,value:dateRange,showToday:false});Ext.fly("js-dateFromLink").on("click",cal.show,cal);var c=Ext.get('js-children-1');c.on('change',showChildren,this);c.on('keyup',showChildren,this);setDepartureDate();Ext.get('js-to').on('focus',function(e,t){t.value='';},this,{single:true});}}
var mySelectHandler=function(c,d){cal.el.hide();depDay.dom.value=d.getDate();depMon.dom.value=d.getMonth()+1;depYear.dom.value=d.getFullYear();}
var validateForm=function(e){var blockSub1=true;var blockSub2=true;var errDep=Ext.get("js-error-departure"),inputDep=Ext.get("js-from").dom,errDest=Ext.get("js-error-destination"),inputDest=Ext.get("js-to").dom;if(inputDep.value=="UNDEFINED"){errDep.dom.innerHTML="Please select your departure airport";errDep.show();}else{errDep.hide();blockSub1=false;}
if(inputDest.value.length<1||inputDest.value=="Please type your destination"){errDest.dom.innerHTML="Please type in your destination or click 'More search options' to see the list of destinations available";errDest.show();}else{errDest.hide();blockSub2=false;}
(blockSub1||blockSub2)&&e.preventDefault();}
var setDepartureDate=function(){var dateRange=new Date();dateRange.setTime(dateRange.getTime()+(1000*60*60*24*3));depDay.dom.value=dateRange.getDate();depMon.dom.value=dateRange.getMonth()+1;depYear.dom.value=dateRange.getFullYear();}
var showChildren=function(numChildren){var elem,c=Ext.get("js-childages");if(numChildren>0){c.show();var l=5;while(l>0){--l;elem=Ext.get("js-childage-"+l);if(l>numChildren)elem.hide();else elem.show();}}else{c.hide();}}
return{init:init}}
return{getInstance:function(){if(!UI){UI=constructor();}
return UI;}}}();DM.Footer=function(){new DM.Tabs('footer',{tabOffClass:'dm-tab',tabOnClass:'dm-tab-on',paneOffClass:'js-hide'});}
DM.CoffeeBreak={init:function(o){Ext.fly(o.id).on('click',this.popWin);},popWin:function(e){var l=e.getTarget('a',3);if(l){window.open(l.href,'','status=1,height=550,width=700');}}}
DM.BC=(function(){var UI,constructor=function(){var BCPlayers={};DM.BCInstance=function(o){this.init(o);}
DM.BCInstance.prototype={init:function(o){this.el=Ext.get(o.id);if(!this.el||!brightcove)
return;this.o=o;},getPlayerRef:function(eId){this.bcExp=brightcove.getExperience(eId);this.modVP=this.bcExp.getModule(APIModules.VIDEO_PLAYER);this.modCon=this.bcExp.getModule(APIModules.CONTENT);this.adModule=this.bcExp.getModule(APIModules.ADVERTISING);},loadByRefId:function(r){this.modVP.loadVideo(r,'referenceId');},loadById:function(id){this.modVP.cueVideo(id);var adPolicy=this.adModule.getAdPolicy();if(adPolicy){var duration=this.modVP.getVideoDuration();var length=(duration>120)?120:Math.floor(duration/30)*30;adPolicy.playerAdKeys=adPolicy.playerAdKeys.replace(/length=(\d+)/,'length='+length);this.adModule.setAdPolicy(adPolicy);}
this.modVP.play();}}
var init=function(o){BCPlayers[o.id+'-video']=new DM.BCInstance(o);}
var setPlayerRef=function(eId){if(BCPlayers[eId])
BCPlayers[eId].getPlayerRef(eId);}
var getPlayerByRef=function(eId){if(BCPlayers[eId])
return BCPlayers[eId];return null;}
return{init:init,setPlayerRef:setPlayerRef,getPlayerByRef:getPlayerByRef}}
return{getInstance:function(){if(!UI)
UI=constructor();return UI;}}})();function onTemplateLoaded(eId){DM.BC.getInstance().setPlayerRef(eId);var player=brightcove.getPlayer(eId);if(!player){return;}
var videoplayer=player.getModule(APIModules.VIDEO_PLAYER);var exp=player.getModule(APIModules.EXPERIENCE);var content=player.getModule(APIModules.CONTENT);var adModule=player.getModule(APIModules.ADVERTISING);if(!exp||!videoplayer||!adModule||!content){return;}
exp.addEventListener(BCExperienceEvent.TEMPLATE_READY,function(evt){if(DM.videoMuted)
videoplayer.setVolume(0);var adPolicy=adModule.getAdPolicy();if(adPolicy){var duration=player.modules.videoPlayer.getVideoDuration();var length=(duration>120)?120:Math.floor(duration/30)*30;if(adPolicy.playerAdKeys.indexOf("length")!=-1)
adPolicy.playerAdKeys=adPolicy.playerAdKeys.replace(/length=(\d+)/,'length='+length);else
adPolicy.playerAdKeys=adPolicy.playerAdKeys+";length="
+length;if(videoplayer.getCurrentVideo().customFields.rightster)
adPolicy.playerAdKeys=adPolicy.playerAdKeys+";video="
+videoplayer.getCurrentVideo().customFields.rightster;adModule.setAdPolicy(adPolicy);}});}
DM.BCVideoList=(function(){var UI,constructor=function(){var playerRef,infoRef,el;var init=function(o){el=Ext.get(o.id);infoRef=Ext.get("js-main-vid-info");if(!el||!infoRef)return;el.on('click',clickListener);}
var clickListener=function(e){var l=e.getTarget('.js-vid-link',3,true);if(l){e.preventDefault();if(!playerRef){playerRef=DM.BC.getInstance().getPlayerByRef('video-hp-player-video');}
playerRef.loadById(AND.getHrefParams(l.dom));var content=l.next('.hidden');if(content){infoRef.dom.innerHTML=content.dom.innerHTML;}}}
return{init:init}}
return{getInstance:function(){if(!UI)UI=constructor();return UI;}}})();DM.TimSearch=function(id,conf){Ext.apply(this,conf);this.init({id:id});};DM.TimSearch.prototype={_el:null,init:function(o){this._el=Ext.get(o.id);if(!this._el){return;}
this._el.on('submit',this._onSubmit,this);},_onSubmit:function(e){var checkedEl=this._el.select('input[name=searchWhere]:checked').item(0),redirectUrl;if(checkedEl&&checkedEl.dom.value==='company'&&checkedEl.dom.checked){e.preventDefault();redirectUrl=this.link+this._el.select('input[name=searchPhrase]').item(0).dom.value;(this._el.dom.target&&this._el.dom.target==='_top')?window.parent.location=redirectUrl:window.location=redirectUrl;}}};DM.TimCalculator=Ext.extend(Ext.util.Observable,(function(){var _rules={'mandatory':/^.+$/,'number':/^-?[\d,]*(\.\d*)?$/,'integer':/^-?[\d,]*$/,"pNumber":/^[\d,]*(\.\d*)?$/,"pInteger":/^[\d,]*$/},SEL_INPUTS_CONTAINER='.calc-inputs',SEL_INPUTS=SEL_INPUTS_CONTAINER+' input[name], '+SEL_INPUTS_CONTAINER+' select[name]',SEL_CALC_BTN='button[name=calculate]',SEL_RESULTS_CONTAINER='.calc-results',SEL_RESULTS=SEL_RESULTS_CONTAINER+' input[name]',SEL_MSG='.calc-msg';return{_formEl:null,_inputs:{},_inputEls:{},constructor:function(id,config){var that=this,formEl=Ext.get(id);if(!formEl){return;}
this._formEl=formEl;Ext.apply(this,config);this._inputEls=formEl.select(SEL_INPUTS).each(function(el){if(el.dom.type&&el.dom.type==='text'){el.on('keyup',that.runCalc,that);}
if(el.dom.type&&(el.dom.type==='radio'||el.dom.type==='checkbox')){el.on('click',that.runCalc,that);}
if(el.dom.type==='select-one'){el.on('change',that.runCalc,that);}});formEl.on('submit',this.runCalc,this,{preventDefault:true});formEl.select(SEL_CALC_BTN).on('click',this.runCalc,this);this.addEvents('b4run','b4submitRun');},_readInput:function(el,showErrors){var that=this,elName=el.dom.name,reqs,ruleName,ruleToTest;if(!el){return;}
showErrors=showErrors||false;if(el.dom.type==='text'||el.dom.type==='select-one'){this._inputs[elName]=el.dom.value;}
if(el.dom.type==='radio'&&el.dom.checked){this._inputs[elName]=el.dom.value;}
if(el.dom.type==='checkbox'&&el.dom.checked){this._inputs[elName]=el.dom.value;}
el.isNumeric=false;if(typeof this.rq[elName]!=='undefined'||typeof this.rq['*']!=='undefined'){reqs=this.rq[elName]||this.rq['*'];for(var i=0,len=reqs.length;i<len;i+=1){if(reqs[i].constructor.name==='RegExp'){ruleToTest=reqs[i];}else{ruleName=reqs[i];if(typeof _rules[ruleName]==='undefined'){continue;}
ruleToTest=_rules[ruleName];if(/^p?number|p?integer$/i.test(ruleName)){el.isNumeric=true;}}
if(!ruleToTest.test(this._inputs[elName])){if(showErrors){el.addClass('failed');}
return false;}}}
el.removeClass('failed');if(el.isNumeric){this._inputs[elName]=+(this._inputs[elName].replace(/,/g,'').replace(/\s/g,''));}
return true;},runCalc:function(ev){var that=this,formEl=this._formEl,formulae=this.fx,results={},isValid=true,showErrors=false;if(ev&&ev.type==='keyup'){if(ev.keyCode===9){return;}}
if(Ext.isEmpty(formulae)){return;}
this.fireEvent('b4run');if(ev&&ev.type==='click'){this.fireEvent('submitRun');}
formEl.select(SEL_RESULTS).each(function(el){el.dom.value='';});showErrors=(ev&&ev.type==='click');this._inputEls.each(function(el){if(!isValid){that._readInput(el,showErrors);}else{isValid=that._readInput(el,showErrors);}});if(!isValid){return;}
for(var fxName in formulae){if(formulae.hasOwnProperty(fxName)){if(typeof formulae[fxName]==='function'){results[fxName]=formulae[fxName].call(this,this._inputs,results);if(Ext.isEmpty(results[fxName])){continue;}
formEl.select(SEL_RESULTS_CONTAINER+' input[name='+fxName+']').each(function(el){el.dom.value=(typeof results[fxName]==='number')?that.formatNum(results[fxName],2):results[fxName];});}}}},formatNum:function(n,decimals,thousandSep,decPoint){var prec=!isFinite(+decimals)?0:Math.abs(decimals),sep=(typeof thousandsSep==='undefined')?',':thousandsSep,dec=(typeof decPoint==='undefined')?'.':decPoint,s='',toFixedFix=function(n,prec){var k=Math.pow(10,prec);return''+Math.round(n*k)/k;};if(!isFinite(n)){return null;}
s=(prec?toFixedFix(n,prec):''+Math.round(n)).split('.');if(s[0].length>3){s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,sep);}
if((s[1]||'').length<prec){s[1]=s[1]||'';s[1]+=new Array(prec-s[1].length+1).join('0');}return s.join(dec);},printMsg:function(msg,css){var formEl=this._formEl;if(!msg)return;css=(css)?'calc-msg '+css:'calc-msg';formEl.select(SEL_RESULTS_CONTAINER).item(0).insertHtml('afterBegin','<p class="'+css+'">'+msg+'</p>');this.on('b4run',function(){formEl.select(SEL_MSG).each(function(el){el.remove();});},this,{single:true});}};})());DM.TimCalculatorJSON=Ext.extend(DM.TimCalculator,(function(){var _headEl=document.getElementsByTagName("head").item(0),_isAppended=[],_isLoaded=[];return{constructor:function(id,config){var that=this,onFocus;DM.TimCalculatorJSON.superclass.constructor.call(this,id,config);if(this.dataSource&&this.dataSource.url){onFocus=function(){that.appendScript(that.dataSource.url);that._inputEls.each(function(el){Ext.EventManager.un(el,'focus',onFocus);});};this._inputEls.on('focus',onFocus);this.on('b4submitRun',function(){if(!_isLoaded[encodeURI(that.dataSource.url)]){that.appendScript(that.dataSource.url,true,that.runCalc);}});}},appendScript:function(url,force,callback){var that=this,scriptTag;function scriptOnLoad(){scriptTag.parentNode.removeChild(scriptTag);_isLoaded[encodeURI(url)]=true;if(typeof callback==='function'){callback.call(that);}}
if(!url){return;}
if(_isAppended[encodeURI(url)]&&!force){return;}
scriptTag=document.createElement('script');scriptTag.setAttribute('type','text/javascript');scriptTag.src=url;scriptTag.onload=function(){scriptTag.onloadDone=true;scriptOnLoad();};scriptTag.onreadystatechange=function(){if(('loaded'===scriptTag.readyState||'complete'===scriptTag.readyState)&&!scriptTag.onloadDone){scriptOnLoad();}};_headEl.appendChild(scriptTag);_isAppended[encodeURI(url)]=true;}};})());DM.HousePriceCalculator=Ext.extend(DM.TimCalculatorJSON,{constructor:function(id,config){DM.HousePriceCalculator.superclass.constructor.call(this,id,config);},getPrice:function(area,year,type){var dataSets=DM.HousePriceCalculator.dataSets,data,price;if(!dataSets||!this.dataSource||!this.dataSource.key){return;}
data=dataSets[this.dataSource.key];if(!data||!data[area]||!data[area][year]||!data[area][year][type]){return;}
price=data[area][year][type];if(typeof price==='number'&&isFinite(price)){return price;}
if(Ext.isArray(price)){for(var i=0,len=price.length,acc=0;i<len;i+=1){if(typeof price[i]!=='number'||!isFinite(price[i])){return;}
acc+=price[i];}
return acc/len;}}});DM.HousePriceCalculator.dataSets={};DM.InflationCalculator=Ext.extend(DM.TimCalculatorJSON,{constructor:function(id,config){DM.InflationCalculator.superclass.constructor.call(this,id,config);},getInflationRate:function(year){var dataSets=DM.InflationCalculator.dataSets||null,data;if(year===2011){return 1;}
if(!dataSets){return null;}
data=(this.dataSource&&this.dataSource.key)?dataSets[this.dataSource.key]:null;if(!data){return null;}
if(typeof data[year]==='undefined'||!isFinite(data[year])){return null;}
return data[year];},getCompoundedRate:function(year,baseYear){var dataSets=DM.InflationCalculator.dataSets||null,data,factor={};if(year===2011){return 1;}
if(!dataSets){return null;}
data=(this.dataSource&&this.dataSource.key)?dataSets[this.dataSource.key]:null;if(!data){return null;}
if(typeof data[year]==='undefined'||!isFinite(data[year])){return null;}
baseYear=baseYear||2010;factor[baseYear+1]=1;for(var y=baseYear;y>=1900;y-=1){if(!isFinite(data[y])||!isFinite(factor[y+1])){return null;}
factor[y]=factor[y+1]*(data[y]+100)/100;factor[y]=Math.round(factor[y]*100)/100;if(y===year){return factor[y];}}
return null;}});DM.InflationCalculator.dataSets={};DM.TimAccordion=function(id,config){config&&Ext.apply(DM.TimAccordion.prototype,config);this.init(id);};DM.TimAccordion.prototype={cellWidth:152,maxWidth:496,interval:30000,selCell:'h4',selCol:'.col',selCellOpen:'h4.open',selPane:'.pane',init:function(id){var that=this;this._el=Ext.get(id);if(!this._el){return;}
this._cellCurrent=this._el.select(this.selCellOpen).item(0);this._colCurrent=this._cellCurrent.parent(this.selCol);this._paneCurrent=this._cellCurrent.next(this.selPane);this._el.select(this.selCell).on('click',that._handleClick,this,{stopEvent:true});if(this.interval){this._introTimer=setInterval(function(){that._openRandom.call(that)},this.interval);}
this._el.select('.pane .radios').on('submit',function(e,t){e.preventDefault();window.location=t.action;});this._el.select('.pane .radios').on('click',function(e,t){var form=e.getTarget('form',5);if(!form||!t.value){return;}
form.action=t.value;},this,{delegate:'input[type=radio]'});},_openRandom:function(){var randIndex=Math.floor(Math.random()*8),el=this._el.select(this.selCell).item(randIndex);if(el){if(!el.is('.open')){this._openCell(el);}else{this._openRandom();}}},_handleClick:function(e,t){clearInterval(this._introTimer);this._openCell(e.getTarget(this.selCell,0,true));},_openCell:function(el){var that=this,indexOpen,indexToOpen;function setOpen(){that._cellToOpen.addClass('open');that._paneToOpen.addClass('open');}
function setAnchoring(el1,el2){el1.setStyle({'left':'auto','right':'0'});el2.setStyle({'left':that.cellWidth+'px','right':'auto'});}
if(this._wip){return;}
this._cellToOpen=el;if(!this._cellToOpen||this._cellToOpen.hasClass('open')){return;}
this._colToOpen=this._cellToOpen.parent(this.selCol);this._paneToOpen=this._cellToOpen.next(this.selPane);this._wip=true;if(this._colToOpen.id===this._colCurrent.id){that._paneToOpen.fadeIn();that._paneCurrent.fadeOut({callback:function(){setOpen();that._paneCurrent.show();that._postAnim();}});return;}
setOpen();indexOpen=+/.*?col-(\d)$/.exec(this._colCurrent.id)[1];indexToOpen=+/.*?col-(\d)$/.exec(this._colToOpen.id)[1];if(indexToOpen<indexOpen){setAnchoring(this._paneToOpen,this._paneCurrent);}else{setAnchoring(this._paneCurrent,this._paneToOpen);}
this._animate();},_animate:function(){var that=this,collapsingW=this._colCurrent.getWidth(),expandingW=this._colToOpen.getWidth(),loop=0,duration=800,start=(new Date).valueOf(),timer;function moveIt(){var cellWidth=that.cellWidth,maxWidth=that.maxWidth,elapsed=(new Date).valueOf(),frame=(elapsed>start+duration)?1:((elapsed-start)/duration),step=Math.floor(frame*(maxWidth-cellWidth));loop=loop+1;if(loop>300||frame===1){that._colCurrent.setStyle('width',cellWidth+'px');that._colToOpen.setStyle('width',maxWidth+'px');that._postAnim();clearInterval(timer);return;}
if(collapsingW>cellWidth){collapsingW=maxWidth-step;that._colCurrent.setStyle('width',collapsingW+'px');}
if(expandingW<maxWidth){expandingW=cellWidth+step;that._colToOpen.setStyle('width',expandingW+'px');}}
timer=setInterval(moveIt,8);},_postAnim:function(){this._wip=false;this._cellCurrent.removeClass('open');this._paneCurrent.removeClass('open');this._colCurrent=this._colToOpen;this._cellCurrent=this._cellToOpen;this._paneCurrent=this._paneToOpen;}};DM.BingSearchBox=function(id,conf){Ext.apply(this,conf,{market:'en-gb'});this.init({id:id});};DM.BingSearchBox.prototype={init:function(o){var that=this,fEl=Ext.get(o.id);if(!fEl){return;}
function handleSubmit(e){var checkedEl=fEl.query('input[name=sel]:checked')[0],phraseEl=fEl.query('input[name=searchPhrase]')[0],phraseVal=(phraseEl&&phraseEl.value)?phraseEl.value:'';e.preventDefault();if(checkedEl&&checkedEl.value==='web'&&checkedEl.checked){window.open('http://www.bing.com/search?q='+phraseVal+'&mkt='+that.market+'&cp=1252&FORM=MOL635','_blank');}else{fEl.dom.submit();}}
fEl.select('.bing-logo').on('click',handleSubmit);fEl.on('submit',handleSubmit);}};DM.TabbedTeamLinks=Ext.extend(DM.Tabs,{tabOffClass:["js-unactive"],tabOnClass:["js-active"],constructor:function(id){DM.Headlines.superclass.constructor.call(this,id);},_onLoadCallBack:function(){var heighMain=Ext.fly(this._panes[0]).getHeight();var paneMore=Ext.get(this._panes[1])
var amount=(Ext.isIE6||Ext.isIE7)?0:10;if(paneMore.query("li").length>1){amount=0}
paneMore.setHeight(heighMain-amount);}});DM.BreakingBanner=function(id,conf){Ext.apply(this,conf,{market:'en-gb'});this.init({id:id});};DM.BreakingBanner.prototype={timeout:6000,init:function(o){var that=this,handle=Ext.get(o.id),headlines=handle.child('.itms').child('div'),timeouts=[],opt={},int;if(!handle&&!headlines){return;}
function skip(){while(timeouts.length>0){clearTimeout(timeouts[timeouts.length-1]);timeouts.pop();}
fadeToNext();}
function newScrollLeft(){c=headlines.child('.first');d=c.child('div');if((headlines.getWidth()-d.getWidth())<0){opt={duration:((d.getWidth()-headlines.getWidth())/20),callback:skip};d.setXY([headlines.getX()+(headlines.getWidth()-d.getWidth()),d.getY()],opt);}else{timeouts.push(setTimeout(fadeToNext,that.timeout));}}
function fadeToNext(){current=headlines.child('.first');current.sequenceFx();if(opt.anim){if(opt.anim.isAnimated){opt.anim.stop();}}
current.fadeOut({easing:'easeOut',duration:0.5});setTimeout(fadeToNextPart2,500);}
function fadeToNextPart2(current){current=headlines.child('.first');current.removeClass("first");current.child('div').setLeft(0);if(current.next('div.b-item')!==null){current=current.next('div.b-item');}else{current=headlines.first('div.b-item');}
current.addClass("first");current.fadeIn({easing:'easeIn',duration:0.5});timeouts.push(setTimeout(newScrollLeft,that.timeout/2));}
timeouts.push(setTimeout(newScrollLeft,that.timeout));}};DM.FancyHeadlines={init:function(o){if(!Array.prototype.forEach){Array.prototype.forEach=function(fn,scope){for(var i=0,len=this.length;i<len;++i){fn.call(scope||this,this[i],i,this);}}}
var el=Ext.get(o.id),that=this;if(!el){return;}
that.parent=o.id;Ext.Ajax.autoAbort=true;that.headlineTemplate=new Ext.Template('<li class="dynArticle" data-aid="{artID}">','<div class="article hdln-cont">','<a href="{artURL}"><img src="http://i.dailymail.co.uk{imgURL}"></a>','<div class="hdln">','<h3 class="linkro-darkred"><a class="title" href="{artURL}">{headline}</a></h3>','<p>{prevText}</p>','</div>','<div class="comments">','<div class="article-icon-links-container">','<ul class="article-icon-links cleared">','</ul>');that.headlineEndTemplate=new Ext.Template('</div>','</div>','</div>','</li>');that.commentsTemplate=new Ext.Template('<li>','<a class="comments-link" href="{artURL}#comments" rel="nofollow">','<span class="icon"></span><span class="linktext">Comments (<span class="readerCommentNo" rel="{artID}">{comCount}</span>)</span>','</a>','</li>');that.videoTemplate=new Ext.Template('<li>','<a class="videos-link" href="{artURL}#video" rel="nofollow">','<span class="icon"></span><span class="linktext">Videos</span>','</a>','</li>');that.shareTemplate=new Ext.Template('<li class="gr3ox">','<a class="{shortURL}| js-sl share-link" href="#">','<span class="icon"></span> <span class="linktext">Share</span>','</a>','</li>');that.loadingTemplate=new Ext.Template('<li class="loading"><div>Loading more articles...</div></li>');that.newArticlesTemplate=new Ext.Template('<li class="newArticles">','<div>There {plural1} {count}new article{plural2} available - <a href="#{channel}">Reload</a></div>','</li>');Ext.onReady(function(){var lis=el.child('.menu-cont').child('ul').select('li'),drop=el.child("div.inner-cont").child("div.dropmenu").select("div");lis.each(function(li){a=li.child('a');a.on('click',that.selectChan,that,{params:o});});drop.each(function(div){a=div.child('a');a.on('click',that.selectChan,that,{params:o});});el.child('.menu-cont').child('div').on('click',function(e){el.child('.inner-cont').child('div').setStyle("display","block");e.stopPropagation();});Ext.getBody().on('click',function(){el.child('.inner-cont').child('div').setStyle("display","none");});that.channel="all";that.fetchChan(that,"all",0,o.id);var checkScrollTask={run:that.checkScroll,interval:500,scope:that};var checkNewTask={run:that.checkNew,interval:10000,scope:that};Ext.TaskMgr.start(checkScrollTask);Ext.TaskMgr.start(checkNewTask);});},checkScroll:function(){var list=Ext.get(this.parent).child("div.inner-cont").child("ul"),count=list.dom.children.length;if(count>1){if(!Ext.get(list.dom.lastChild).hasClass("loading")){if((window.pageYOffset?window.pageYOffset:document.documentElement.scrollTop)>(Ext.get(list.dom.lastChild).getY()-1500)){this.loadingTemplate.append(list,{});this.fetchChan(this,this.channel,count,this.parent);}}}},checkNew:function(){var that=this;if(!Ext.Ajax.isLoading()){var hdlnList=Ext.get(this.parent).child("div.inner-cont").child("ul");var list=hdlnList.select('li.dynArticle');Ext.Ajax.request({url:"/api/latest_headlines/"+this.channel+"/"+0+"/30.json",timeout:200000,success:function(response,opts){var id=list.item(0).getAttribute('data-aid'),count=0,found=false;t=Ext.decode(response.responseText);t.forEach(function(art){if(!found&&art.articleId!=id){count++;}else{found=true;}});if(count>0){n=hdlnList.select('li.newArticles');if(n.getCount()!=0){Ext.get(hdlnList.dom.firstChild).remove();}
x=that.newArticlesTemplate.insertFirst(hdlnList,{count:count==30?"":count+" ",channel:that.channel,plural1:count>1?"are":"is",plural2:count>1?"s":""},true);x.child('a').on('click',that.selectChan,that);}}});}},fetchChan:function(that,chan,start,parent,override){if(override||!Ext.Ajax.isLoading()){Ext.Ajax.request({url:"/api/latest_headlines/"+chan+"/"+start+"/30.json",timeout:200000,success:function(response,opts){var hdlnList=Ext.get(parent).child(".inner-cont").child("ul"),t=Ext.decode(response.responseText);if(hdlnList.dom.lastChild)
hdlnList.dom.removeChild(hdlnList.dom.lastChild);t.forEach(function(art){if(art.headline.length>160){var pos=159,quit=false;while(!quit){pos++;if(art.headline.charAt(pos)==' ')
quit=true;if(art.headline.charAt(pos)=='')
quit=true;}
art.headline=art.headline.substring(0,pos)+"...";}
if(art.previewText.length>145){var pos=144,quit=false;while(!quit){pos++;if(art.previewText.charAt(pos)==' ')
quit=true;if(art.previewText.charAt(pos)=='')
quit=true;}
art.previewText=art.previewText.substring(0,pos)+"...";}
if(art.readerCommentsCount==null)
art.readerCommentsCount="-";if(art.imageLinkListPuff){x=that.headlineTemplate.append(hdlnList,{artID:art.articleId,headline:art.headline,prevText:art.previewText,imgURL:art.imageLinkListPuff.imageURL,artURL:art.articleURL,artID:art.articleId},true);if(art.readerComments=="W"||art.readerComments=="R"){that.commentsTemplate.append(x.child('.article-icon-links'),{artURL:art.articleURL,comCount:art.readerCommentsCount,shortURL:art.shortURL});}
if(art.videoFlag){that.videoTemplate.append(x.child('.article-icon-links'),{artURL:art.articleURL});}
that.shareTemplate.append(x.child('.article-icon-links'),{shortURL:art.shortURL});x=that.headlineEndTemplate.append(x,{},true);if(!Ext.isIE){Ext.get(x.child(".article-icon-links").dom.firstChild).addClass("first");}}});if(Ext.isIE){Ext.get(parent).select('.article-icon-links').each(function(el){Ext.get(el.dom.firstChild).addClass("first");});}
DM.has(hdlnList.id,'shareLinks');},failure:function(response,opts){console.log(response);console.log(opts);}});}},selectChan:function(event,el,c){event.preventDefault();var parent=Ext.get(el).parent();var menuels=Ext.get(this.parent).child("div.menu-cont").child("ul").select('span');if(!parent.parent().hasClass("newArticles")){menuels.each(function(el){if(el.hasClass("link-wocc")){el.removeClass("link-wocc").removeClass("linkro-wocc");el.addClass("link-gr6ox").addClass("linkro-ccox");if(el.next()){el.next().addClass('divide');}}else if(el.hasClass("linkro-ccox")){if(el.next()){el.next().addClass('divide');}}});}
if(Ext.get(el).hasClass("dropel")){var menu=Ext.get(this.parent).child("div.menu-cont").child("ul"),menuLi=(Ext.isIE||Ext.isIE7)?Ext.get(menu.dom.lastChild):Ext.get(menu.dom.lastElementChild),menuA=menuLi.child('a'),dropA=Ext.get(el),menuHash=menuA.dom.hash,dropHash=dropA.dom.hash,menuText=(Ext.isIE8||Ext.isIE7)?menuA.dom.innerHTML:menuA.dom.text,dropText=(Ext.isIE8||Ext.isIE7)?dropA.dom.innerHTML:dropA.dom.text,menuClass=menuLi.dom.className,dropClass=parent.parent().dom.className;menuA.dom.hash=dropHash;dropA.dom.hash=menuHash;menuA.dom.innerHTML=dropText;dropA.dom.innerHTML=menuText;menuLi.dom.className=dropClass;parent.parent().dom.className=menuClass;Ext.get((Ext.isIE||Ext.isIE7)?menuLi.dom.lastChild:menuLi.dom.lastElementChild).removeClass("link-gr6ox").removeClass("linkro-ccox");Ext.get((Ext.isIE||Ext.isIE7)?menuLi.dom.lastChild:menuLi.dom.lastElementChild).addClass("link-wocc").addClass("linkro-wocc");menuLi.prev().child(".divide").removeClass("divide");this.channel=dropHash.split("#")[1];}else{if(!parent.parent().hasClass("newArticles")){parent.removeClass("link-gr6ox").removeClass("linkro-ccox");parent.addClass("link-wocc").addClass("linkro-wocc");if(parent.next()){parent.next().removeClass('divide');}
if(parent.parent().prev()){if(parent.parent().prev().child(".divide"))
parent.parent().prev().child(".divide").removeClass("divide");}}
this.channel=event.target.hash.split("#")[1];}
var list=Ext.get(this.parent).child("div.inner-cont").child("ul");while(list.dom.hasChildNodes()){list.dom.removeChild(list.dom.lastChild);}
this.appendLoading(this);this.fetchChan(this,this.channel,0,this.parent,true);},appendLoading:function(that){var list=Ext.get(that.parent).child("div.inner-cont").child("ul");that.loadingTemplate.append(list,{});}};