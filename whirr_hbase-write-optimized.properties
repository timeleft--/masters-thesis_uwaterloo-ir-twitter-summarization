#
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

#
# HBase CDH install
#

whirr.cluster-name=yianaga-hbase

whirr.instance-templates=1 zookeeper+hadoop-namenode+hadoop-jobtracker+hbase-master,1 hadoop-datanode+hadoop-tasktracker+hbase-regionserver, 1 hadoop-tasktracker

# Setup your cloud credentials by copying conf/credentials.sample
# to ~/.whirr/credentials and editing as needed

# replication level should not be higher than number of data nodes
hdfs-site.dfs.replication=1

hbase-site.dfs.replication=1
# Configurations from (http://gbif.blogspot.ca/2012/07/optimizing-writes-in-hbase.html), and agrees with (http://www.quora.com/What-are-some-tips-for-configuring-HBase)
# determines how big a StoreFile is allowed to grow before splitting a region, default is 256MB 268435456, this is 1.5GB
hbase-site.hbase.hregion.max.filesize=1610612736  
# controls when to start blocking writes to keep the MemStore size sane. It defaults to 2 (multiplied by the memstore.flush.size). For production clusters with lots of RAM that you monitor closely, you can up to something like 8. 
hbase-site.hbase.hregion.memstore.block.multiplier=4
# is the threshold for deciding when to flush a single MemStore to disk. It defaults to 64 MB (67108864)
hbase-site.hbase.hregion.memstore.flush.size=134217728
# determines the maximum number of StoreFiles per Store to allow before blocking writes and forcing a compaction. The default is 7, but in production clusters monitored closely, it may make sense to up to 15.should be at least 2x compactionThreshold
hbase-site.hbase.hstore.blockingStoreFiles=20
# used to cap the amount of heap room in each region server to reserve for all MemStores [7] served by that region. It defaults to 40% of the heap. 
#hbase-site.hbase.regionserver.global.memstore.upperLimit=
#And accordig to PalominoDB Counter Performance Test, DEFERRED_LOG_FLUSH must be set on the table level
#hbase.regionserver.optionallogflushinterval=1hr





#custom CDH zookeeper install and configure functions
whirr.zookeeper.install-function=install_cdh_zookeeper
whirr.zookeeper.configure-function=configure_cdh_zookeeper

#custom CDH hadoop install and configure functions
whirr.hadoop.install-function=install_cdh_hadoop
whirr.hadoop.configure-function=configure_cdh_hadoop

#custom CDH hbase install and configure functions
whirr.hbase.install-function=install_cdh_hbase
whirr.hbase.configure-function=configure_cdh_hbase

#
# Customise instance types & AMI for Amazon EC2
#

# 64 bit required, and either Ubuntu 10.04 or CentOS/RHEL 5.x
whirr.template=osFamily=UBUNTU,osVersionMatches=10.04,os64Bit=true,minRam=2048

# Use a specific instance type. See http://aws.amazon.com/ec2/instance-types/
# whirr.hardware-id=c1.xlarge
# whirr.hardware-id=m1.large

# Ubuntu 10.04 LTS Lucid. See http://cloud.ubuntu.com/ami/
# whirr.image-id=us-east-1/ami-35de095c

whirr.image-id=us-east-1/ami-55dc0b3c

# You can also specify the spot instance price: http://aws.amazon.com/ec2/spot-instances/
# whirr.aws-ec2-spot-price=0.15

#
# Or for Rackspace Cloud
#

# The size of the instance to use. See http://www.rackspacecloud.com/cloud_hosting_products/servers/faq/
# id 3: 1GB, 1 virtual core
# id 4: 2GB, 2 virtual cores
# id 5: 4GB, 2 virtual cores
# id 6: 8GB, 4 virtual cores
# id 7: 15.5GB, 4 virtual cores
# whirr.hardware-id=6
# Ubuntu 10.04 LTS Lucid
# whirr.image-id=49

# By default use the user system SSH keys. Override them here.
whirr.private-key-file=${sys:user.home}/.ssh/id_rsa_whirr
whirr.public-key-file=${whirr.private-key-file}.pub

# Options for the hbase master & regionserver processes
#hbase-env.HBASE_MASTER_OPTS=-Xms1000m -Xmx1000m -Xmn256m -XX:+UseConcMarkSweepGC -XX:+AggressiveOpts -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -Xloggc:/data/hbase/logs/hbase-master-gc.log
#hbase-env.HBASE_REGIONSERVER_OPTS=-Xms2000m -Xmx2000m -Xmn256m -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=88 -XX:+AggressiveOpts -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -Xloggc:/data/hbase/logs/hbase-regionserver-gc.log
